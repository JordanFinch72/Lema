{"ast":null,"code":"var _jsxFileName = \"D:\\\\xampp\\\\htdocs\\\\COMP3000_LEMA\\\\Project\\\\lema\\\\client\\\\src\\\\components\\\\modals\\\\ViewMapsModal.jsx\";\nimport { Component } from \"react\";\nimport { Textbox } from \"../controls/Textbox\";\nimport { Button } from \"../controls/Button\";\nimport { LabeledControl } from \"../controls/LabeledControl\";\nimport axios from \"axios\";\nimport { GenericModal } from \"./GenericModal\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass MapItem extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"map-item\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: this.props.map.activeMap.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 20,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"buttons-container\",\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          value: \"SHARE LINK\",\n          onClick: e => {\n            const domain = \"http://localhost:3000/\"; // Major TODO: Update this when hosted\n\n            const link = `http://localhost:3000/map/${this.props.activeUser.username}/${this.props.map.activeMap.mapID}`;\n\n            const linkModal = /*#__PURE__*/_jsxDEV(GenericModal, {\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Here is the link to your map: \", /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: link,\n                  children: link\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 28,\n                  columnNumber: 40\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 28,\n                  columnNumber: 65\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 28,\n                  columnNumber: 71\n                }, this), \"This will not share your map to the showcase, but anybody with the link can access it.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 29,\n                  columnNumber: 96\n                }, this), \"Whenever you save your map, your changes will be shown via this same link.\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 27,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 26,\n              columnNumber: 8\n            }, this);\n\n            this.props.openModal(null, linkModal, true);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 22,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          value: \"LOAD\",\n          onClick: e => {\n            const userConfirmed = window.confirm(\"This will overwrite your currently active map.\\nYou may wish to save your map before you load another one.\\n\\nWould you like to continue?\");\n            if (userConfirmed) this.props.loadMap(e, this.props.map, \"database\");\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 35,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          value: \"X\",\n          onClick: e => {\n            const userConfirmed = window.confirm(\"This will permanently delete this map from the database (and the showcase)!\\n\\nWould you like to continue?\");\n            if (userConfirmed) this.props.deleteMap(e, this.props.map.activeMap.mapID);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 41,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 21,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 18,\n      columnNumber: 4\n    }, this);\n  }\n\n}\n\nexport class ViewMapsModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loadedMaps: [],\n      loadedFileName: null,\n      loading: true\n    };\n    this.loadUserMaps = this.loadUserMaps.bind(this);\n    this.onFieldChange = this.onFieldChange.bind(this);\n  }\n\n  componentDidMount() {\n    const response = this.loadUserMaps();\n    if (response === \"Token refreshed.\") this.loadUserMaps();\n  }\n\n  loadUserMaps() {\n    // Fetch maps belonging to this user\n    const username = this.props.activeUser.username;\n    const jwt = this.props.activeUser.jwt;\n    axios.get(`/maps/${username}/0/${jwt}`).then(response => {\n      console.log(response);\n\n      if (response.data.type === \"error\") {\n        if (response.data.error && response.data.error.name === \"TokenExpiredError\") {\n          // Send refresh token to server to retrieve new JWT\n          let activeUser = this.state.activeUser;\n          axios.get(`jwt/refresh/${activeUser.username}/${activeUser.refreshToken}`).then(res => {\n            if (res.data.type === \"success\" && res.data.message === \"Token refreshed.\") {\n              activeUser = { ...activeUser,\n                jwt: res.data.tokens[0],\n                refreshToken: res.data.tokens[1]\n              };\n              this.setState({\n                activeUser: activeUser\n              }, function () {\n                if (localStorage.getItem(\"LEMA_activeUser\")) // Update only if they have asked to be remembered\n                  localStorage.setItem(\"LEMA_activeUser\", JSON.stringify(activeUser));\n              });\n            }\n          });\n          return \"Token refreshed.\";\n        } else {\n          console.error(response.data.message);\n          this.createToast(null, response.data.message, 5000, \"error\");\n          return false;\n        }\n      } else if (response.data.type === \"success\") {\n        console.log(response.data);\n\n        if (response.data.message === \"User's maps retrieved.\") {\n          this.setState({\n            loadedMaps: response.data.maps,\n            loading: false\n          });\n          return true;\n        }\n      }\n    });\n  }\n\n  onFieldChange(event) {\n    const target = event.target;\n    const name = target.name;\n    const value = target.type === \"checkbox\" ? target.checked : target.value;\n    this.setState({\n      [name]: value\n    });\n  }\n\n  render() {\n    let mapItems = [];\n    this.state.loadedMaps.forEach(m => mapItems.push( /*#__PURE__*/_jsxDEV(MapItem, {\n      activeUser: this.props.activeUser,\n      map: m,\n      openModal: this.props.openModal,\n      loadMap: this.props.loadMap,\n      deleteMap: this.props.deleteMap\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 54\n    }, this)));\n    if (this.state.loading) mapItems = \"Loading...\";else if (mapItems.length === 0) mapItems = \"No maps here! Try saving one to your profile! Alternatively, feel free to load one in from a file.\";\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"top\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"left load\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"View / Import Map\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"map-data\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"section\",\n              children: mapItems\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"section\",\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                children: \"Load From File\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"form\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  id: \"mapJSON\",\n                  name: \"mapJSON\",\n                  accept: \"application/json\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 160,\n                  columnNumber: 10\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  value: \"Import...\",\n                  onClick: e => {\n                    const files = document.getElementById(\"mapJSON\").files;\n\n                    if (files.length > 0) {\n                      const userConfirmed = window.confirm(\"This will overwrite your current map.\\nYou should save your map before you load another one.\\n\\nWould you like to continue?\");\n\n                      if (userConfirmed) {\n                        const fileReader = new window.FileReader();\n\n                        fileReader.onload = () => this.props.loadMap(e, JSON.parse(fileReader.result), \"file\");\n\n                        fileReader.readAsText(files[0]);\n                      }\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 161,\n                  columnNumber: 10\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 9\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bottom\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 4\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["D:/xampp/htdocs/COMP3000_LEMA/Project/lema/client/src/components/modals/ViewMapsModal.jsx"],"names":["Component","Textbox","Button","LabeledControl","axios","GenericModal","MapItem","constructor","props","render","map","activeMap","title","e","domain","link","activeUser","username","mapID","linkModal","openModal","userConfirmed","window","confirm","loadMap","deleteMap","ViewMapsModal","state","loadedMaps","loadedFileName","loading","loadUserMaps","bind","onFieldChange","componentDidMount","response","jwt","get","then","console","log","data","type","error","name","refreshToken","res","message","tokens","setState","localStorage","getItem","setItem","JSON","stringify","createToast","maps","event","target","value","checked","mapItems","forEach","m","push","length","files","document","getElementById","fileReader","FileReader","onload","parse","result","readAsText"],"mappings":"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","sourcesContent":["import {Component} from \"react\";\r\nimport {Textbox} from \"../controls/Textbox\";\r\nimport {Button} from \"../controls/Button\";\r\nimport {LabeledControl} from \"../controls/LabeledControl\";\r\nimport axios from \"axios\";\r\nimport {GenericModal} from \"./GenericModal\";\r\n\r\nclass MapItem extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className={\"map-item\"}>\r\n\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t<div className={\"title\"}>{this.props.map.activeMap.title}</div>\r\n\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t<Button value={\"SHARE LINK\"} onClick={(e) => {\r\n\t\t\t\t\t\tconst domain = \"http://localhost:3000/\"; // Major TODO: Update this when hosted\r\n\t\t\t\t\t\tconst link = `http://localhost:3000/map/${this.props.activeUser.username}/${this.props.map.activeMap.mapID}`;\r\n\t\t\t\t\t\tconst linkModal =\r\n\t\t\t\t\t\t\t<GenericModal>\r\n\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\tHere is the link to your map: <a href={link}>{link}</a><br /><br />\r\n\t\t\t\t\t\t\t\t\tThis will not share your map to the showcase, but anybody with the link can access it.<br />\r\n\t\t\t\t\t\t\t\t\tWhenever you save your map, your changes will be shown via this same link.\r\n\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t</GenericModal>\r\n\t\t\t\t\t\tthis.props.openModal(null, linkModal, true);\r\n\t\t\t\t\t}} />\r\n\t\t\t\t\t<Button value={\"LOAD\"} onClick={(e) => {\r\n\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will overwrite your currently active map.\\nYou may wish to save your map before you load another one.\\n\\nWould you like to continue?\");\r\n\r\n\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\tthis.props.loadMap(e, this.props.map, \"database\");\r\n\t\t\t\t\t}} />\r\n\t\t\t\t\t<Button value={\"X\"} onClick={(e) => {\r\n\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will permanently delete this map from the database (and the showcase)!\\n\\nWould you like to continue?\");\r\n\r\n\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\tthis.props.deleteMap(e, this.props.map.activeMap.mapID);\r\n\t\t\t\t\t}} />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport class ViewMapsModal extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tloadedMaps: [],\r\n\t\t\tloadedFileName: null,\r\n\t\t\tloading: true\r\n\t\t};\r\n\r\n\t\tthis.loadUserMaps = this.loadUserMaps.bind(this);\r\n\t\tthis.onFieldChange = this.onFieldChange.bind(this);\r\n\r\n\t}\r\n\r\n\tcomponentDidMount()\r\n\t{\r\n\t\tconst response = this.loadUserMaps();\r\n\t\tif(response === \"Token refreshed.\")\r\n\t\t\tthis.loadUserMaps();\r\n\t}\r\n\r\n\tloadUserMaps()\r\n\t{\r\n\t\t// Fetch maps belonging to this user\r\n\t\tconst username = this.props.activeUser.username;\r\n\t\tconst jwt = this.props.activeUser.jwt;\r\n\t\taxios.get(`/maps/${username}/0/${jwt}`).then((response) =>\r\n\t\t{\r\n\t\t\tconsole.log(response);\r\n\t\t\tif(response.data.type === \"error\")\r\n\t\t\t{\r\n\t\t\t\tif(response.data.error && response.data.error.name === \"TokenExpiredError\")\r\n\t\t\t\t{\r\n\t\t\t\t\t// Send refresh token to server to retrieve new JWT\r\n\t\t\t\t\tlet activeUser = this.state.activeUser;\r\n\t\t\t\t\taxios.get(`jwt/refresh/${activeUser.username}/${activeUser.refreshToken}`).then((res) => {\r\n\t\t\t\t\t\tif(res.data.type === \"success\" && res.data.message === \"Token refreshed.\")\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tactiveUser = {\r\n\t\t\t\t\t\t\t\t...activeUser,\r\n\t\t\t\t\t\t\t\tjwt: res.data.tokens[0],\r\n\t\t\t\t\t\t\t\trefreshToken: res.data.tokens[1]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.setState({activeUser: activeUser}, function(){\r\n\t\t\t\t\t\t\t\tif(localStorage.getItem(\"LEMA_activeUser\")) // Update only if they have asked to be remembered\r\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_activeUser\", JSON.stringify(activeUser));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn \"Token refreshed.\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.error(response.data.message);\r\n\t\t\t\t\tthis.createToast(null, response.data.message, 5000, \"error\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(response.data.type === \"success\")\r\n\t\t\t{\r\n\t\t\t\tconsole.log(response.data);\r\n\t\t\t\tif(response.data.message === \"User's maps retrieved.\")\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.setState({loadedMaps: response.data.maps, loading: false});\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonFieldChange(event)\r\n\t{\r\n\t\tconst target = event.target;\r\n\t\tconst name = target.name;\r\n\t\tconst value = (target.type === \"checkbox\") ? target.checked : target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\t[name]: value\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tlet mapItems = [];\r\n\t\tthis.state.loadedMaps.forEach((m) => mapItems.push(<MapItem activeUser={this.props.activeUser} map={m} openModal={this.props.openModal}\r\n\t\t                                                            loadMap={this.props.loadMap} deleteMap={this.props.deleteMap} />));\r\n\t\tif(this.state.loading)\r\n\t\t\tmapItems = \"Loading...\";\r\n\t\telse if(mapItems.length === 0)\r\n\t\t\tmapItems = \"No maps here! Try saving one to your profile! Alternatively, feel free to load one in from a file.\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"modal\"}>\r\n\t\t\t\t<div className={\"top\"}>\r\n\t\t\t\t\t<div className={\"left load\"}>\r\n\t\t\t\t\t\t<h2>View / Import Map</h2>\r\n\t\t\t\t\t\t<div className={\"map-data\"}>\r\n\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t{mapItems}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t<h4>Load From File</h4>\r\n\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t<input type={\"file\"} id={\"mapJSON\"} name={\"mapJSON\"} accept={\"application/json\"} />\r\n\t\t\t\t\t\t\t\t\t<Button value={\"Import...\"} onClick={(e) =>\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tconst files = document.getElementById(\"mapJSON\").files;\r\n\t\t\t\t\t\t\t\t\t\tif(files.length > 0)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will overwrite your current map.\\nYou should save your map before you load another one.\\n\\nWould you like to continue?\");\r\n\t\t\t\t\t\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileReader = new window.FileReader();\r\n\t\t\t\t\t\t\t\t\t\t\t\tfileReader.onload = () => this.props.loadMap(e, JSON.parse(fileReader.result), \"file\");\r\n\t\t\t\t\t\t\t\t\t\t\t\tfileReader.readAsText(files[0]);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={\"bottom\"}>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}