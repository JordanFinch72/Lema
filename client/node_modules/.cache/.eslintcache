[{"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\index.js":"1","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\Lema.js":"2","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\reportWebVitals.js":"3","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\LeftBar.jsx":"4","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Map.jsx":"5","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Banner.jsx":"6","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\CollectionArea.jsx":"7","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\ControlBox.jsx":"8","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\AddEditNodeModal.jsx":"9","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\ContextMenu.jsx":"10","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\LoginRegisterModal.jsx":"11","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Textbox.jsx":"12","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\AddEditCollectionModal.jsx":"13","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\RadioGroup.jsx":"14","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Collection.jsx":"15","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Button.jsx":"16","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\LabeledControl.jsx":"17","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\ColourPicker.jsx":"18","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Meatballs.jsx":"19","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Collapser.jsx":"20","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\SaveModal.jsx":"21","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\ViewMapsModal.jsx":"22","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\ProfileSettingsModal.jsx":"23","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\CommunityMap.jsx":"24","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\GenericModal.jsx":"25","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Toast.jsx":"26"},{"size":505,"mtime":1651584160173,"results":"27","hashOfConfig":"28"},{"size":31748,"mtime":1651846573148,"results":"29","hashOfConfig":"28"},{"size":362,"mtime":499162500000,"results":"30","hashOfConfig":"28"},{"size":1195,"mtime":1651575099435,"results":"31","hashOfConfig":"28"},{"size":26743,"mtime":1651846485486,"results":"32","hashOfConfig":"28"},{"size":4475,"mtime":1651961239302,"results":"33","hashOfConfig":"28"},{"size":7022,"mtime":1651848731547,"results":"34","hashOfConfig":"28"},{"size":5580,"mtime":1651577323772,"results":"35","hashOfConfig":"28"},{"size":16216,"mtime":1651846537575,"results":"36","hashOfConfig":"28"},{"size":622,"mtime":1650475059232,"results":"37","hashOfConfig":"28"},{"size":9389,"mtime":1651842863526,"results":"38","hashOfConfig":"28"},{"size":898,"mtime":1650970523561,"results":"39","hashOfConfig":"28"},{"size":2720,"mtime":1651847145007,"results":"40","hashOfConfig":"28"},{"size":1377,"mtime":1651081009901,"results":"41","hashOfConfig":"28"},{"size":4963,"mtime":1651848368597,"results":"42","hashOfConfig":"28"},{"size":611,"mtime":1647013078795,"results":"43","hashOfConfig":"28"},{"size":571,"mtime":1650634151163,"results":"44","hashOfConfig":"28"},{"size":637,"mtime":1647089426759,"results":"45","hashOfConfig":"28"},{"size":724,"mtime":1647016194577,"results":"46","hashOfConfig":"28"},{"size":428,"mtime":1650475053516,"results":"47","hashOfConfig":"28"},{"size":3909,"mtime":1651845467394,"results":"48","hashOfConfig":"28"},{"size":4173,"mtime":1651848260546,"results":"49","hashOfConfig":"28"},{"size":2666,"mtime":1651577369333,"results":"50","hashOfConfig":"28"},{"size":1313,"mtime":1651158923386,"results":"51","hashOfConfig":"28"},{"size":117,"mtime":1651572569537,"results":"52","hashOfConfig":"28"},{"size":156,"mtime":1651577154890,"results":"53","hashOfConfig":"28"},{"filePath":"54","messages":"55","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"56","usedDeprecatedRules":"57"},"mz6ydj",{"filePath":"58","messages":"59","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"60","usedDeprecatedRules":"57"},{"filePath":"61","messages":"62","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"63","messages":"64","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"65","messages":"66","errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"67","usedDeprecatedRules":"57"},{"filePath":"68","messages":"69","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"70"},{"filePath":"71","messages":"72","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"73","usedDeprecatedRules":"57"},{"filePath":"74","messages":"75","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"76","messages":"77","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"78","messages":"79","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"80","messages":"81","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"82","usedDeprecatedRules":"57"},{"filePath":"83","messages":"84","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"85","messages":"86","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"87","usedDeprecatedRules":"57"},{"filePath":"88","messages":"89","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"90","messages":"91","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"92","usedDeprecatedRules":"57"},{"filePath":"93","messages":"94","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"95","messages":"96","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"97","messages":"98","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"99","messages":"100","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"101","messages":"102","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"103","messages":"104","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"105","messages":"106","errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"107","usedDeprecatedRules":"57"},{"filePath":"108","messages":"109","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"110","messages":"111","errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"112","usedDeprecatedRules":"57"},{"filePath":"113","messages":"114","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"115","messages":"116","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\index.js",["117"],"import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Lema from './Lema';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Lema />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n//reportWebVitals();\n",["118","119"],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\Lema.js",["120"],"import \"./css/Lema.css\";\nimport {Component} from \"react\";\nimport axios from \"axios\";\nimport {useJwt} from \"react-jwt\";\nimport {Banner} from \"./components/Banner\";\nimport {LeftBar} from \"./components/LeftBar\";\nimport {Map} from \"./components/Map\";\nimport {ViewMapsModal} from \"./components/modals/ViewMapsModal\";\nimport {Toast} from \"./components/Toast\";\nconst jwt = require(\"jsonwebtoken\");\n\n\nclass Lema extends Component\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tactiveToast: null,       // Either null or a React component\n\t\t\tactiveModal: null,       // Either null or a React component\n\t\t\tactiveContextMenu: null, // Either null or a React component\n\t\t\tactiveUser: null,        // Set upon user login\n\t\t\tactiveMap: null,         // Either null, set by load function, or set by save function once saved to profile\n\t\t\tcollections: [],\n\t\t\tjourneyCount: 0,\n\t\t\tisShowcaseMode: false\n\t\t};\n\n\t\tthis.toastTimeout = null;\n\t\tthis.defaultJourneyColours = [\"#ff0000\", \"#00ff00\", \"#0000ff\", \"#da35aa\", \"#ffcc00\"] // TODO: Better colours\n\n\t\tthis.flattenTree = this.flattenTree.bind(this);\n\t\tthis.createToast = this.createToast.bind(this);\n\t\tthis.openModal = this.openModal.bind(this);\n\t\tthis.closeModal = this.closeModal.bind(this);\n\t\tthis.openContextMenu = this.openContextMenu.bind(this);\n\t\tthis.closeContextMenu = this.closeContextMenu.bind(this);\n\t\tthis.addCollection = this.addCollection.bind(this);\n\t\tthis.editCollection = this.editCollection.bind(this);\n\t\tthis.addJourneyFromDatabase = this.addJourneyFromDatabase.bind(this);\n\t\tthis.addNode = this.addNode.bind(this);\n\t\tthis.editNode = this.editNode.bind(this);\n\t\tthis.removeNode = this.removeNode.bind(this);\n\t\tthis.removeCollection = this.removeCollection.bind(this);\n\t\tthis.authenticateUser = this.authenticateUser.bind(this);\n\t\tthis.registerUser = this.registerUser.bind(this);\n\t\tthis.logoutUser = this.logoutUser.bind(this);\n\t\tthis.editProfile = this.editProfile.bind(this);\n\t\tthis.deleteProfile = this.deleteProfile.bind(this);\n\t\tthis.toggleShowcaseMode = this.toggleShowcaseMode.bind(this);\n\t\tthis.newMap = this.newMap.bind(this);\n\t\tthis.saveMap = this.saveMap.bind(this);\n\t\tthis.loadMap = this.loadMap.bind(this);\n\t\tthis.deleteMap = this.deleteMap.bind(this);\n\t\tthis.handleResponse = this.handleResponse.bind(this);\n\t}\n\n\t/**\n\t * As part of React's lifecycle, this function is automatically called once the component is rendered (\"mounted\"),\n\t * i.e. at page load/refresh (when the component is created).\n\t */\n\tcomponentDidMount()\n\t{\n\t\t// Check if user is already logged in\n\t\tconst activeUser = JSON.parse(localStorage.getItem(\"LEMA_activeUser\"));\n\t\tif(activeUser)\n\t\t\tthis.setState({activeUser: activeUser});\n\n\t\t// Check if user has been linked a map\n\t\tconst urlParts = window.location.href.split('/');\n\t\tif(urlParts.includes(\"map\"))\n\t\t{\n\t\t\tconst userConfirmed = window.confirm(\"You are loading another person's map.\\nThis will overwrite your currently active map.\\n\\n\" +\n\t\t\t\t\"Do you wish to continue?\");\n\t\t\tif(userConfirmed)\n\t\t\t{\n\t\t\t\tconst username = urlParts[4];\n\t\t\t\tconst mapID = urlParts[5];\n\t\t\t\taxios.get(`/maps/${username}/${mapID}`).then((response) => {\n\t\t\t\t\tif(this.handleResponse(response, \"User's map retrieved.\", null))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loadMap(null, response.data.map, \"database\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Check for activeMap data (mapID, title, description, isShared)\n\t\t\tconst activeMap = JSON.parse(localStorage.getItem(\"LEMA_activeMap\"));\n\t\t\tif(activeMap)\n\t\t\t\tthis.setState({activeMap: activeMap});\n\n\t\t\t// Check if there are active collections (DISTINCT FROM activeMap!)\n\t\t\tconst activeCollections = JSON.parse(localStorage.getItem(\"LEMA_activeCollections\"));\n\t\t\tif(activeCollections)\n\t\t\t\tthis.setState({collections: activeCollections.collections, journeyCount: activeCollections.journeyCount}, function() {\n\t\t\t\t\t/* Repair parent links: memory references are lost when serialising to and from JSON string */\n\t\t\t\t\t/* Justification for O(n^4): this callback function only runs once when user refreshes/re-enters the page;\n\t\t\t\t\tand the arrays involved will never be large enough for it to be an issue. Future solution: autosave to PouchDB. */\n\t\t\t\t\tfor(let i = 0; i < this.state.collections.length; ++i) // Loop through collections\n\t\t\t\t\t{\n\t\t\t\t\t\tconst collection = this.state.collections[i];\n\t\t\t\t\t\tfor(let j = 0; j < collection.words.length; ++j) // Loop through words\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst word = collection.words[j];\n\t\t\t\t\t\t\tfor(let n = 0; n < word.parents.length; ++n) // Loop through parents\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst parent = word.parents[n];\n\t\t\t\t\t\t\t\tfor(let x = 0; x < collection.words.length; ++x) // Loop through words again\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst parentWord = collection.words[x];\n\t\t\t\t\t\t\t\t\tif(parent.id === parentWord.id)\n\t\t\t\t\t\t\t\t\t\tword.parents[n] = parentWord;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\n\n\t}\n\n\t/**\n\t * Sends log in data to server to authenticate user.\n\t * @param e SyntheticEvent\n\t * @param data Login data\n\t */\n\tauthenticateUser(e, data)\n\t{\n\t\t// Check the user\n\t\tconst username = data.loginUsername;\n\t\tconst password = data.loginPassword;\n\t\tconst rememberMe = data.rememberMe;\n\n\t\taxios.get(`/users/${username}/${password}`).then((response) => {\n\t\t\tif(this.handleResponse(response, \"User found.\", \"Login successful!\"))\n\t\t\t{\n\t\t\t\tconsole.log(response);\n\t\t\t\tconst decodedToken = jwt.decode(response.data.tokens[0], {});\n\t\t\t\tconsole.log(decodedToken);\n\t\t\t\tconst activeUser = {\n\t\t\t\t\tusername: decodedToken.username,\n\t\t\t\t\tdisplayName: decodedToken.displayName,\n\t\t\t\t\tjwt: response.data.tokens[0],\n\t\t\t\t\trefreshToken: response.data.tokens[1]\n\t\t\t\t};\n\n\t\t\t\tthis.setState({activeUser: activeUser}, () => {\n\t\t\t\t\tif(rememberMe) localStorage.setItem(\"LEMA_activeUser\", JSON.stringify(activeUser));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t}\n\t/**\n\t * Sends register data to server to create a new user profile.\n\t * @param e SyntheticEvent\n\t * @param data Registration data\n\t */\n\tregisterUser(e, data)\n\t{\n\t\t// Register the user\n\t\tconst {displayName, username, password, email} = data;\n\n\t\taxios.put(`/users/${displayName}/${username}/${password}/${email}`).then((response) => {\n\t\t\tthis.handleResponse(response, \"User created.\", \"Profile created! You may now log in.\");\n\t\t});\n\t}\n\n\t/**\n\t * Logs the user out of the app.\n\t * @param e SyntheticEvent\n\t * @param forceLogout Whether the logout should be forced (when called by internal functions)\n\t */\n\tlogoutUser(e, forceLogout = false)\n\t{\n\t\tlet userConfirmed = false;\n\t\tif(!forceLogout) userConfirmed = window.confirm(\"Are you sure you wish to log out? This will clear your active map data.\");\n\n\t\tif(userConfirmed || forceLogout)\n\t\t{\n\t\t\tlocalStorage.removeItem(\"LEMA_activeUser\");\n\t\t\tlocalStorage.removeItem(\"LEMA_activeMap\");\n\t\t\tlocalStorage.removeItem(\"LEMA_activeCollections\");\n\t\t\tthis.setState({activeUser: null, activeMap: null, collections: [], journeyCount: 0});\n\t\t}\n\t}\n\n\t/**\n\t * A recursive function that flattens the nested data structure returned from the etymological database into an\n\t * array of word nodes.\n\t * @param wordArray Flat array of words (initially empty)\n\t * @param edWords Object of words returned by the etymological database\n\t * @param edStructure Original data structure returned by the etymological database\n\t * @param edAffixes Array of affixed returned by the etymological database (used to filter out affixes)\n\t * @param wordID The ID of the word currently being operated on in the recursive function\n\t * @returns {array} The wordArray object, which has nodes pushed to it throughout the function\n\t */\n\tflattenTree(wordArray, edWords, edStructure, wordID, edAffixes = null)\n\t{\n\t\tlet parents = [], wordNode = {};\n\t\t// Parents\n\t\tif(Object.keys(edStructure).length > 0)\n\t\t{\n\t\t\t// Loop through parents\n\t\t\tfor(const wordID in edStructure)\n\t\t\t{\n\t\t\t\tif((edAffixes !== null && !edAffixes.includes(Number(wordID)))\n\t\t\t\t\t|| edAffixes == null)\n\t\t\t\t{\n\t\t\t\t\tparents.push(wordID);\n\t\t\t\t\twordArray = this.flattenTree(wordArray, edWords, edStructure[wordID], wordID, edAffixes);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Retrieve word from ED and convert to Lema-compatible object\n\t\tif(wordID !== null)\n\t\t{\n\t\t\twordNode = edWords[wordID];\n\t\t\twordNode = {\n\t\t\t\tid: Number(wordID),\n\t\t\t\tarrayIndex: wordArray.length,\n\t\t\t\tword: wordNode.word,\n\t\t\t\tlanguage: wordNode.language_name,\n\t\t\t\tparents: [],\n\t\t\t\tvertex: {type: \"word\", customText: \"\", fontColour: \"#000000\", strokeColour: \"#000000\", fillColour: this.defaultJourneyColours[this.state.journeyCount], radius: null, fontSize: null, x: null, y: null, edgeStart: \"centre\", edgeEnd: \"centre\", edgeStrokeColour: \"#000000\", edgeStrokeWidth: \"2px\", edgeArrowheadEnabled: true, edgeArrowheadStrokeColour: \"#000000\", edgeArrowheadFillColour: \"#000000\"}\n\t\t\t}\n\t\t\tfor(let i = 0; i < parents.length; ++i)\n\t\t\t{\n\t\t\t\tconst parentID = Number(parents[i]);\n\t\t\t\tconst parent = wordArray.find(({id}) => id === parentID);\n\t\t\t\tif((edAffixes !== null && !edAffixes.includes(parentID))\n\t\t\t\t\t|| edAffixes === null)\n\t\t\t\t{\n\t\t\t\t\twordNode.parents.push(parent);\n\t\t\t\t}\n\t\t\t}\n\t\t\twordArray.push(wordNode);\n\t\t}\n\t\treturn wordArray;\n\t}\n\n\t/**\n\t * Creates a journey collection from words returned by the etymological database and automatically adds them to the existing journey collections array\n\t * @param edWords Object of words returned by the etymological database\n\t * @param edStructure Original data structure returned by the etymological database\n\t * @param edAffixes Array of affixed returned by the etymological database (used to filter out affixes)\n\t */\n\taddJourneyFromDatabase(edWords, edStructure, edAffixes = null)\n\t{\n\t\tconst newCollections = this.state.collections, newJourneyCount = this.state.journeyCount;\n\n\t\t// Flatten the data structure\n\t\tlet journeyWords = [];\n\t\tjourneyWords = this.flattenTree(journeyWords, edWords, edStructure, null, edAffixes);\n\n\t\t// Create the new journey and add it to collections\n\t\tconst newJourney = {type: \"journey\", header: {word: journeyWords[journeyWords.length-1].word, language: journeyWords[journeyWords.length-1].language}, words: journeyWords};\n\t\tnewCollections.push(newJourney);\n\n\t\tthis.setState({collections: newCollections, journeyCount: newJourneyCount+1}, function(){\n\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t});\n\t}\n\n\t/**\n\t * Creates a\n\t * @param e SyntheticEvent\n\t * @param contents HTML contents to be displayed in the toast.\n\t * @param time Time in ms to keep the toast open\n\t * @param type What type of alert the toast is showing: neutral, error, or success\n\t */\n\tcreateToast(e, contents, time = 5000, type = \"neutral\")\n\t{\n\t\tconst toast =\n\t\t\t<Toast type={type}>\n\t\t\t\t{contents}\n\t\t\t</Toast>\n\t\tthis.setState({activeToast: toast}, function(){\n\t\t\twindow.clearTimeout(this.toastTimeout);\n\t\t\tthis.toastTimeout = window.setTimeout(() => {\n\t\t\t\tthis.setState({activeToast: null});\n\t\t\t}, time);\n\t\t})\n\t}\n\n\t/**\n\t * Opens a modal if one is not already open.\n\t * @param e SyntheticEvent\n\t * @param modalComponent React component of the modal that is to be opened.\n\t * @param forceClose Whether to close active modals first.\n\t */\n\topenModal(e, modalComponent, forceClose = false)\n\t{\n\t\tif(!this.state.activeModal || forceClose)\n\t\t\tthis.setState({activeModal: modalComponent});\n\t}\n\n\t/**\n\t * Closes any currently-open modal.\n\t */\n\tcloseModal()\n\t{\n\t\tif(this.state.activeModal)\n\t\t\tthis.setState({activeModal: null});\n\t}\n\n\t/**\n\t * Opens a context menu if one is not already open.\n\t * Note: currently, only one context menu can be active at a time. This means context menus' items must not attempt to open a context menu on themselves.\n\t * @param e\n\t * @param menuComponent A React component of the context menu that is to be opened.\n\t */\n\topenContextMenu(e, menuComponent)\n\t{\n\t\tif(!this.state.activeContextMenu)\n\t\t\tthis.setState({activeContextMenu: menuComponent});\n\t}\n\n\t/**\n\t * Closes any currently-open context menu.\n\t */\n\tcloseContextMenu()\n\t{\n\t\tif(this.state.activeContextMenu)\n\t\t\tthis.setState({activeContextMenu: null});\n\t}\n\n\t/**\n\t * Toggles showcase mode.\n\t * @param toggle Optional parameter to force showcase to switch to either true or false.\n\t */\n\ttoggleShowcaseMode(e, toggle = null)\n\t{\n\t\tconst isShowcaseMode = (toggle !== null) ? toggle : !this.state.isShowcaseMode;\n\t\tthis.setState({isShowcaseMode: isShowcaseMode});\n\t}\n\n\t/**\n\t * Adds a node to the specified collection in the state's collection array.\n\t * @param e SyntheticEvent\n\t * @param collectionIndex The index of the collection to which the new node will belong.\n\t * @param newNode The new node.\n\t * @param newCollectionIndex Optional parameter to set the node to a new/different collection.\n\t */\n\taddNode(e, collectionIndex, newNode, newCollectionIndex = null)\n\t{\n\t\tconst collectionIndexActual = (newCollectionIndex !== null) ? newCollectionIndex : collectionIndex;\n\n\t\t// Validation (note: node data validation exists in the AddEditNodeModal)\n\t\tlet errorCollector = \"\";\n\t\tif(this.state.collections[collectionIndexActual].type === \"cognate\")\n\t\t{\n\t\t\t// Check for existing language\n\t\t\tfor(let i = 0; i < this.state.collections[collectionIndexActual].words.length; ++i)\n\t\t\t{\n\t\t\t\tconst childNode = this.state.collections[collectionIndexActual].words[i];\n\t\t\t\tif(childNode.language === newNode.language)\n\t\t\t\t{\n\t\t\t\t\terrorCollector += \"A language can only appear in a cognate collection once.\\n\" +\n\t\t\t\t\t\t\t\t\t  \"Additional cognate collections may contain a language used in another cognate collection.\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(errorCollector.length > 0)\n\t\t\tthis.createToast(null, errorCollector, 7000, \"error\");\n\t\telse\n\t\t{\n\t\t\t// Insert new node\n\t\t\tconst newCollections = this.state.collections;\n\t\t\tnewNode.arrayIndex = newCollections[collectionIndexActual].words.length;\n\t\t\tnewCollections[collectionIndexActual].words.push(newNode);\n\n\t\t\tthis.setState({collections: newCollections}, function(){\n\t\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t\t\tthis.closeModal();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Updates a node in the specified collection in the state's collections array with updated data.\n\t * @param e React SyntheticEvent\n\t * @param collectionIndex Index of collection to which the node belongs.\n\t * @param updatedNode The updated node to be set in the collections array.\n\t * @param newCollectionIndex Optional parameter to set the node to a new collection.\n\t */\n\teditNode(e, collectionIndex, updatedNode, newCollectionIndex = null)\n\t{\n\t\tconst newCollections = this.state.collections;\n\n\t\t// Find node\n\t\tconst node = newCollections[collectionIndex].words[updatedNode.arrayIndex];\n\n\t\t// Update node by reference\n\t\tfor(const index in updatedNode)\n\t\t\tif(node[index]) node[index] = updatedNode[index];\n\n\t\t// Additional operations if node was moved from one collection to another\n\t\tif(newCollectionIndex !== null)\n\t\t{\n\t\t\tnode.arrayIndex = newCollections[newCollectionIndex].words.length; // Update arrayIndex to reflect new collection\n\t\t\tnode.parents.splice(0, node.parents.length);                  // Clear parents\n\t\t\tnewCollections[newCollectionIndex].words.push(node);               // Add node to new collection\n\t\t\tthis.removeNode(e, collectionIndex, updatedNode.arrayIndex);       // Delete node from original collection\n\t\t}\n\n\t\tthis.setState({collections: newCollections}, () => {\n\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t\tthis.closeModal();\n\t\t});\n\t}\n\n\t/**\n\t * Removes a specified node from a specified collection in the state's collections array.\n\t * The user will be warned before deletion occurs (and will be notified of any existing parents, lest they have to add them all again).\n\t * @param e SyntheticEvent\n\t * @param collectionIndex Index of the collection to which the node belongs.\n\t * @param arrayIndex Index of the node inside the specified collection.\n\t */\n\tremoveNode(e, collectionIndex, arrayIndex)\n\t{\n\t\tconst newCollections = this.state.collections;\n\n\t\t// Find node\n\t\tconst node = newCollections[collectionIndex].words[arrayIndex];\n\t\tlet confirmed = false;\n\t\tif(node.parents.length > 0)\n\t\t\tconfirmed = window.confirm(\"Warning: this node is connected to \"+node.parents.length+\" parent nodes. The nodes will be unaffected by the deletion/move. Do you still wish to delete/move?\");\n\t\telse\n\t\t\tconfirmed = window.confirm(\"Are you sure you wish to delete/move this node?\");\n\n\t\tif(confirmed)\n\t\t{\n\t\t\tnewCollections[collectionIndex].words.splice(arrayIndex, 1); // Delete node\n\n\t\t\tfor(let i = 0; i < newCollections[collectionIndex].words.length; ++i)\n\t\t\t{\n\t\t\t\tconst word = newCollections[collectionIndex].words[i];\n\t\t\t\tif(word.arrayIndex > arrayIndex) word.arrayIndex = word.arrayIndex-1; // Shift down after splice\n\n\t\t\t\t// Delete node in parents array of others (as splice() does not delete by reference)\n\t\t\t\tfor(let j = 0; j < word.parents.length; ++j)\n\t\t\t\t{\n\t\t\t\t\tif(word.parents[j].id === node.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tword.parents.splice(j, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setState({collections: newCollections}, function(){\n\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t\tthis.closeModal();\n\t\t});\n\t}\n\n\t/**\n\t * Adds a new collection to the state's collection array.\n\t * @param e SyntheticEvent\n\t * @param data An object containing the data required to build the new collection (collection object).\n\t */\n\taddCollection(e, data)\n\t{\n\t\tconst newCollections = this.state.collections;\n\t\tlet newJourneyCount = this.state.journeyCount;\n\n\t\t// Only one cognate allowed, for now // TODO\n\t\tif(data.type === \"cognate\" && newCollections.find(e => e.type === \"cognate\") !== undefined)\n\t\t\tthis.createToast(e, \"Support for multiple cognate collections coming soon!\");\n\t\telse\n\t\t{\n\t\t\tif(data.type === \"journey\")\n\t\t\t\tnewJourneyCount += 1;\n\t\t\tnewCollections.push({type: data.type, header: data.header, words: []});\n\t\t\tthis.setState( {collections: newCollections, journeyCount: newJourneyCount}, function(){\n\t\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t\t\tthis.closeModal();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Updates an existing collection in the state's collection array with updated data.\n\t * @param e SyntheticEvent\n\t * @param data An object containing the data required to update the existing collection (collection object, collection index).\n\t */\n\teditCollection(e, data)\n\t{\n\t\tconst newCollections = this.state.collections;\n\t\tnewCollections[data.index].type = data.type;\n\t\tnewCollections[data.index].header = data.header;\n\n\t\tthis.setState({collections: newCollections}, function(){\n\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t\tthis.closeModal();\n\t\t});\n\t}\n\n\t/**\n\t * Removes the specified collection from the state's collection array.\n\t * @param e SyntheticEvent\n\t * @param collectionIndex Index of the collection to be removed.\n\t */\n\tremoveCollection(e, collectionIndex)\n\t{\n\t\tconst newCollections = this.state.collections;\n\t\tlet newJourneyCount = this.state.journeyCount;\n\t\tif(newCollections[collectionIndex].type === \"journey\")\n\t\t\tnewJourneyCount = this.state.journeyCount-1;\n\n\t\tnewCollections.splice(collectionIndex, 1); // Remove the collection\n\n\t\tthis.setState({collections: newCollections, journeyCount: newJourneyCount}, function(){\n\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: newCollections, journeyCount: this.state.journeyCount}));\n\t\t});\n\t}\n\n\t/**\n\t * Wipes activeMap and collections data, allowing the user to start from scratch.\n\t * @param e SyntheticEvent\n\t */\n\tnewMap(e)\n\t{\n\t\tlocalStorage.removeItem(\"LEMA_activeMap\");\n\t\tlocalStorage.removeItem(\"LEMA_activeCollections\");\n\t\twindow.location.href = \"/\";\n\t}\n\n\t/**\n\t * Serialises the map to JSON then saves it in the manner specified.\n\t * @param data User-specified data about the map (such as the title).\n\t */\n\tsaveMap(e, data)\n\t{\n\t\tconst username = this.state.activeUser.username;\n\t\tconst activeMapID = (this.state.activeMap) ? this.state.activeMap.mapID : null;\n\t\tconst isNewMap = data.isNewMap;\n\n\t\t// Attach map data\n\t\tdata.mapData = {collections: this.state.collections, journeyCount: this.state.journeyCount};\n\n\t\tif(data.saveMode === \"Save to profile\")\n\t\t{\n\t\t\t// Send to server\n\t\t\tif(activeMapID === null || isNewMap)\n\t\t\t{\n\t\t\t\t// Insert new map\n\t\t\t\taxios.put(`/maps/${username}`, {data: data, jwt: this.state.activeUser.jwt}).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tif(this.handleResponse(response, \"Map inserted.\", \"Map saved!\", true, () => this.saveMap(e, data)))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setState({activeMap: response.data.activeMap}, function(){\n\t\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_activeMap\", JSON.stringify(this.state.activeMap));\n\t\t\t\t\t\t}); // Set new map data returned by server\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Update map\n\t\t\t\taxios.put(`/maps/${username}/${activeMapID}`, {data: data, jwt: this.state.activeUser.jwt}).then((response) => {\n\t\t\t\t\tif(this.handleResponse(response, \"Map data updated.\", \"Map saved!\", true, () => this.saveMap(e, data)))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setState({activeMap: response.data.activeMap}, function(){\n\t\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_activeMap\", JSON.stringify(this.state.activeMap));\n\t\t\t\t\t\t}); // Set new map data returned by server\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse if(data.saveMode === \"Export to JSON file\")\n\t\t{\n\t\t\t// Strip extraneous data\n\t\t\tdelete data.saveMode; delete data.isNewMap; data.mapID = null;\n\n\t\t\t// Set up download\n\t\t\tconst a = document.createElement(\"a\");\n\t\t\tconst blob = new Blob([JSON.stringify(data, null, 4)], {type: 'application/json'});\n\t\t\ta.href = URL.createObjectURL(blob);\n\t\t\ta.download = `map_${this.state.activeUser.username}_${data.title.replace(/\\s+/g, '')}`; // File name (stripped of spaces)\n\t\t\ta.click(); // Download\n\t\t}\n\t\telse if(data.saveMode === \"Export to SVG\")\n\t\t{\n\t\t\tconst svg = document.getElementById(\"map-svg\");\n\n\t\t\t// Pre-processing\n\t\t\tconst map_container = document.getElementsByClassName(\"map-container\")[0];\n\t\t\tconst width = map_container.clientWidth, height = map_container.clientHeight;\n\t\t\tsvg.setAttribute(\"width\", `${width}px`);\n\t\t\tsvg.setAttribute(\"height\", `${height}px`);\n\n\t\t\t// Build BLOB of SVG\n\t\t\tconst a = document.createElement(\"a\");\n\t\t\tconst blob = new Blob([svg.outerHTML], {type: \"image/svg+xml;charset=utf-8\"});\n\t\t\ta.href = URL.createObjectURL(blob);\n\t\t\ta.download = `map_${this.state.activeUser.username}_${data.title.replace(/\\s+/g, '')}.svg`; // File name (stripped of spaces)\n\t\t\ta.click(); // Download\n\t\t\tsvg.removeAttribute(\"width\");\n\t\t\tsvg.removeAttribute(\"height\");\n\t\t}\n\t\telse if(data.saveMode === \"Export to PNG\")\n\t\t{\n\t\t\tconst svg = document.getElementById(\"map-svg\");\n\n\t\t\t// Pre-processing\n\t\t\tconst map_container = document.getElementsByClassName(\"map-container\")[0];\n\t\t\tconst width = map_container.clientWidth, height = map_container.clientHeight;\n\t\t\tsvg.setAttribute(\"width\", `${width}px`);\n\t\t\tsvg.setAttribute(\"height\", `${height}px`);\n\n\t\t\t// Construct image data\n\t\t\tconst image = new Image();\n\t\t\tconst serializer = new XMLSerializer();\n\t\t\tconst imageString = serializer.serializeToString(svg);\n\t\t\t\timage.src = \"data:image/svg+xml;base64, \" + window.btoa(unescape(encodeURIComponent(imageString)));\n\n\t\t\t// Wait until image has finished loading\n\t\t\timage.onload = () => {\n\t\t\t\t// Create mock canvas; draw and extract image\n\t\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\tcanvas.getContext(\"2d\").drawImage(image, 0, 0, width, height);\n\t\t\t\tconst imageData = canvas.toDataURL(\"image/png\");\n\n\t\t\t\tconst a = document.createElement(\"a\");\n\t\t\t\ta.download = `map_${this.state.activeUser.username}_${data.title.replace(/\\s+/g, '')}`; // File name (stripped of spaces)\n\t\t\t\ta.href = imageData;\n\t\t\t\ta.dataset.downloadurl = [\"image/png\", a.download, a.href].join(':');\n\t\t\t\ta.click(); // Download\n\t\t\t\tsvg.removeAttribute(\"width\");\n\t\t\t\tsvg.removeAttribute(\"height\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Loads the map using data returned by the server.\n\t * @param e SyntheticEvent\n\t * @param map The map object to be loaded.\n\t * @param loadMode Whether the map has been loaded from the database or via user file upload.\n\t */\n\tloadMap(e, map, loadMode)\n\t{\n\t\t// Build activeMap object if loaded from local file\n\t\tconst activeMap = (loadMode === \"database\") ? map.activeMap : {\n\t\t\tmapID: null,\n\t\t\ttitle: map.title,\n\t\t\tdescription: map.description,\n\t\t\tisShared: map.isShared\n\t\t};\n\t\tthis.setState({collections: []}, function(){ // Note: This is somewhat horrific, but the collections don't re-render otherwise\n\t\t\tthis.setState({\n\t\t\t\tactiveMap: activeMap,\n\t\t\t\tcollections: map.mapData.collections,\n\t\t\t\tjourneyCount: map.mapData.journeyCount\n\t\t\t}, function(){\n\t\t\t\tlocalStorage.setItem(\"LEMA_activeMap\", JSON.stringify(this.state.activeMap));\n\t\t\t\tlocalStorage.setItem(\"LEMA_activeCollections\", JSON.stringify({collections: this.state.collections, journeyCount: this.state.journeyCount}));\n\t\t\t\tthis.closeModal();\n\t\t\t});\n\t\t});\n\n\t}\n\n\tdeleteMap(e, mapID)\n\t{\n\t\tconst username = this.state.activeUser.username;\n\t\tlet activeMap = this.state.activeMap;\n\n\t\t// If they're deleting the currently active map\n\t\tif(activeMap && Number(mapID) === Number(activeMap.mapID))\n\t\t{\n\t\t\t// Unset the activeMap\n\t\t\tactiveMap = null;\n\t\t\tthis.setState({activeMap: activeMap}, function(){\n\t\t\t\tlocalStorage.removeItem(\"LEMA_activeMap\");\n\t\t\t});\n\t\t}\n\n\t\t// Delete the map\n\t\taxios.delete(`/maps/${username}/${mapID}`, {data: {jwt: this.state.activeUser.jwt}}).then((response) => {\n\t\t\tthis.handleResponse(response, \"Map deleted.\", null, false, () => this.deleteMap(e, mapID));\n\t\t\tthis.closeModal();\n\t\t\tthis.openModal(e, <ViewMapsModal loadMap={this.loadMap} deleteMap={this.deleteMap} activeUser={this.state.activeUser} openModal={this.openModal}\n\t\t\t                                 handleResponse={this.handleResponse}  />);\n\t\t});\n\t}\n\n\teditProfile(e, data)\n\t{\n\t\tconst activeUser = this.state.activeUser;\n\t\tconst username = activeUser.username;\n\t\taxios.put(`/users/${username}`, {data: data, jwt: this.state.activeUser.jwt}).then((response) => {\n\t\t\tif(this.handleResponse(response, \"User profile updated.\", \"Profile updated!\", true, () => this.editProfile(e, data)))\n\t\t\t{\n\t\t\t\tactiveUser.displayName = data.displayName; // Update to reflect changes\n\n\t\t\t\tthis.setState({activeUser: activeUser}, () => {\n\t\t\t\t\tif(localStorage.getItem(\"LEMA_activeUser\")) // Update only if they have asked to be remembered\n\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_activeUser\", JSON.stringify(activeUser));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteProfile(e)\n\t{\n\t\tconst username = this.state.activeUser.username;\n\t\taxios.delete(`/users/${username}`, {data: {jwt: this.state.activeUser.jwt}}).then((response) => {\n\t\t\tif(this.handleResponse(response, \"User profile deleted.\", \"User profile deleted!\", true, () => this.deleteProfile(e)))\n\t\t\t{\n\t\t\t\tthis.setState({isShowcaseMode: false});\n\t\t\t\tthis.logoutUser(e, true);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Handles responses from axios calls\n\t * @param response Response returned by axios call.\n\t * @param successMessage Success message expected from server.\n\t * @param successAlert Success message to display to user.\n\t * @param closeModal Whether to close the active modal after the operation is complete.\n\t * @param refreshFunction Function to call if token refresh required\n\t * @returns true if the response was a success; \"Token refreshed\" if the JWT needed to be refreshed first\n\t */\n\thandleResponse(response, successMessage, successAlert, closeModal = true, refreshFunction = null)\n\t{\n\t\tconsole.log(response);\n\t\tif(response.data.type === \"error\")\n\t\t{\n\t\t\tif(response.data.error && response.data.error.name === \"TokenExpiredError\")\n\t\t\t{\n\t\t\t\t// Send refresh token to server to retrieve new JWT\n\t\t\t\tlet activeUser = this.state.activeUser;\n\t\t\t\taxios.get(`jwt/refresh/${activeUser.username}/${activeUser.refreshToken}`).then((res) => {\n\t\t\t\t\tif(this.handleResponse(res, \"Token refreshed.\", null))\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Token refreshed innit\");\n\t\t\t\t\t\tactiveUser = {\n\t\t\t\t\t\t\t...activeUser,\n\t\t\t\t\t\t\tjwt: res.data.tokens[0],\n\t\t\t\t\t\t\trefreshToken: res.data.tokens[1]\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setState({activeUser: activeUser}, function(){\n\t\t\t\t\t\t\tif(localStorage.getItem(\"LEMA_activeUser\")) // Update only if they have asked to be remembered\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_activeUser\", JSON.stringify(activeUser));\n\n\t\t\t\t\t\t\tif(refreshFunction !== null) refreshFunction(); // Re-call function\n\t\t\t\t\t\t\telse return \"Token refreshed.\";\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(response.data.message);\n\t\t\t\tif(response.data.message === \"Invalid refresh token.\") // Invalid refresh token is a security risk; log them out\n\t\t\t\t{\n\t\t\t\t\tthis.logoutUser(null, true);\n\t\t\t\t\tthis.closeModal();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.createToast(null, response.data.message, 5000, \"error\");\n\t\t\t}\n\t\t}\n\t\telse if(response.data.type === \"success\")\n\t\t{\n\t\t\tconsole.log(response.data);\n\t\t\tif(response.data.message === successMessage)\n\t\t\t{\n\t\t\t\tif(successAlert) this.createToast(null, successAlert, 5000, \"success\");\n\t\t\t\tif(closeModal) this.closeModal();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\t// Render any active modals and context menus\n\t\tlet toastContainer = null, modalContainer = null, contextMenuContainer = null;\n\t\tif(this.state.activeToast !== null)\n\t\t{\n\t\t\tconst activeToast = this.state.activeToast;\n\t\t\ttoastContainer =\n\t\t\t\t<div className={\"toast-container\"}>\n\t\t\t\t\t{activeToast}\n\t\t\t\t</div>\n\t\t}\n\n\t\tif(this.state.activeModal !== null)\n\t\t{\n\t\t\tconst activeModal = this.state.activeModal;\n\t\t\tmodalContainer =\n\t\t\t\t<div className={\"modal-container\"} onClick={(e) => {\n\t\t\t\t\tif(e.nativeEvent.target.className === \"modal-container\") this.closeModal(); // Closes modal if they click off the modal\n\t\t\t\t}}>\n\t\t\t\t\t{activeModal}\n\t\t\t\t</div>;\n\t\t}\n\t\tif(this.state.activeContextMenu !== null)\n\t\t{\n\t\t\tconst activeContextMenu = this.state.activeContextMenu;\n\t\t\tcontextMenuContainer =\n\t\t\t\t<div className={\"context-menu-container\"} onClick={this.closeContextMenu} onContextMenu={(e) => e.preventDefault()} >{activeContextMenu}</div>;\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"Lema\">\n\t\t\t\t<Banner activeUser={this.state.activeUser} openModal={this.openModal} activeMap={this.state.activeMap}\n\t\t\t\t        isShowcaseMode={this.state.isShowcaseMode} createToast={this.createToast} handleResponse={this.handleResponse}\n\t\t\t\t        authenticateUser={this.authenticateUser} registerUser={this.registerUser} logoutUser={this.logoutUser}\n\t\t\t\t        editProfile={this.editProfile} deleteProfile={this.deleteProfile} toggleShowcaseMode={this.toggleShowcaseMode}\n\t\t\t\t        newMap={this.newMap} saveMap={this.saveMap} loadMap={this.loadMap} deleteMap={this.deleteMap} />\n\t\t\t\t<div className={\"main-view-container\"}>\n\t\t\t\t\t<LeftBar activeMap={this.state.activeMap} collections={this.state.collections}\n\t\t\t\t\t         isShowcaseMode={this.state.isShowcaseMode} createToast={this.createToast}\n\t\t\t\t\t         openModal={this.openModal} closeModal={this.closeModal}\n\t\t\t\t\t         openContextMenu={this.openContextMenu} closeContextMenu={this.closeContextMenu}\n\t\t\t\t\t         addNode={this.addNode} editNode={this.editNode} removeNode={this.removeNode}\n\t\t\t\t\t         addCollection={this.addCollection} editCollection={this.editCollection} removeCollection={this.removeCollection}\n\t\t\t\t\t         addJourneyFromDatabase={this.addJourneyFromDatabase}\n\t\t\t\t\t/>\n\t\t\t\t\t<Map collections={this.state.collections}\n\t\t\t\t\t     isShowcaseMode={this.state.isShowcaseMode} createToast={this.createToast}\n\t\t\t\t\t     openContextMenu={this.openContextMenu} closeContextMenu={this.closeContextMenu}\n\t\t\t\t\t     openModal={this.openModal} closeModal={this.closeModal}\n\t\t\t\t\t\t addNode={this.addNode} editNode={this.editNode} removeNode={this.removeNode}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t{toastContainer}\n\t\t\t\t{modalContainer}\n\t\t\t\t{contextMenuContainer}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Lema;\n","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\reportWebVitals.js",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\LeftBar.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Map.jsx",["121","122","123","124","125","126","127","128","129","130","131","132","133","134"],"import React, {useEffect} from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport {AddEditNodeModal} from \"./modals/AddEditNodeModal\";\r\nimport {ContextMenu} from \"./controls/ContextMenu\";\r\nimport countriesData from \"../data/countries/countries.json\";\r\nimport languageProperties from \"../data/languageProperties.json\";\r\n\r\nexport function Map(props)\r\n{\r\n\t// DEBUG MODE\r\n\tconst DEBUG_MODE = false;\r\n\r\n\tif(DEBUG_MODE)\r\n\t\tconsole.debug(\"[== MAP RENDER ==]\");\r\n\r\n\t// Prop functions\r\n\tconst openContextMenu = props.openContextMenu.bind(this);\r\n\tconst addNode = props.addNode.bind(this);\r\n\tconst editNode = props.editNode.bind(this);\r\n\tconst removeNode = props.removeNode.bind(this);\r\n\tconst openModal = props.openModal.bind(this);\r\n\tconst createToast = props.createToast.bind(this);\r\n\r\n\t// Props\r\n\tconst collections = props.collections;\r\n\r\n\t// Note: Unfortunately, cannot append React components (then again, that's probably a good thing...)\r\n\tuseEffect(() => {\r\n\t\tconst svg = d3.selectAll(\".map-container\").selectAll(\"svg\");\r\n\t\tconst countries = countriesData.features;\r\n\r\n\t\t// Create path (passed as svg attribute later to draw the countries)\r\n\t\t// TODO: Have it auto-scale as window is dragged/re-sized\r\n\t\tconst width = svg._groups[0][0].clientWidth;\r\n\t\tconst height = svg._groups[0][0].clientHeight;\r\n\t\tconst projection = d3.geoConicConformal()\r\n\t\t\t.center([8, 52.823]) // Middle of Europe(ish)\r\n\t\t\t.scale(1650)\r\n\t\t\t.translate([width/2, height/2]);\r\n\t\tconst path = d3.geoPath().projection(projection);\r\n\r\n\t\tlet coordGroup;\r\n\t\tif(DEBUG_MODE)\r\n\t\t{\r\n\t\t\tcoordGroup = svg.append(\"g\")\r\n\t\t\t\t.classed(\"coords\", true)\r\n\t\t\t\t.attr('transform', 'translate(50,150)')\r\n\t\t}\r\n\r\n\r\n\t\t// Draw countries, bind data and handlers\r\n\t\tconst countryPaths = svg.append(\"g\")\r\n\t\t\t.selectAll(\"path\") // svg->g->path\r\n\t\t\t.data(countries)         // svg->g->path\r\n\t\t\t.enter()                 // svg->g->path (create new nodes per data)\r\n\t\t\t.append(\"path\")          // svg->g->path (create new nodes per data)\r\n\t\t\t.attr(\"fill\", (d) => determineFillColour(d))\r\n\t\t\t.attr(\"stroke\", (d) => determineStrokeColour(d))\r\n\t\t\t.attr(\"stroke-linejoin\", \"round\")\r\n\t\t\t.attr(\"d\", path)\r\n\t\t\t.on(\"click\", function(e, d){\r\n\t\t\t\t// TODO: Possibly same functions as context menu (see about calling this.onContextMenu() to keep things nice and DRY)\r\n\t\t\t\tcreateToast(e, d.properties.name_long, 2000);\r\n\t\t\t})\r\n\t\t\t.on(\"mousemove\", function(e, d)\r\n\t\t\t{\r\n\t\t\t\tif(DEBUG_MODE)\r\n\t\t\t\t{\r\n\t\t\t\t\tconst x = e.offsetX - 612, y = e.offsetY - 528;\r\n\t\t\t\t\tcoordGroup.selectAll(\"text\").remove();\r\n\t\t\t\t\tcoordGroup.append(\"text\")\r\n\t\t\t\t\t\t.text(`(${x},${y})`)\r\n\t\t\t\t\t\t.attr(\"fill\", \"white\");\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"contextmenu\", function(e, d){\r\n\t\t\t\te.preventDefault(); // Prevent browser context menu from opening\r\n\t\t\t\tconst nodeObject = findNodes(d, \"cognate\");\r\n\t\t\t\tlet contextMenuItems = [];\r\n\r\n\t\t\t\t// If clicked-on country has attached cognate\r\n\t\t\t\tif(nodeObject)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontextMenuItems = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: \"Edit node (cognate)\", handler: (e) => {\r\n\t\t\t\t\t\t\t\tconst collectionList = collections.filter((collection, i) => {\r\n\t\t\t\t\t\t\t\t\tif(collection.type === \"cognate\")\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcollection.collectionIndex = i;\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\topenModal(e, <AddEditNodeModal onNodeSubmit={editNode} node={nodeObject.node} collectionList={collectionList}\r\n\t\t\t\t\t\t\t\t                               collectionIndex={nodeObject.collectionIndex}\r\n\t\t\t\t\t\t\t\t                               type={\"cognate\"} language={nodeObject.node.language} />);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: \"Remove node (cognate)\", handler: (e) => {\r\n\t\t\t\t\t\t\t\tremoveNode(e, nodeObject.collectionIndex, nodeObject.arrayIndex);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// TODO: Context menu for adding to new collection, adding to existing collection\r\n\t\t\t\t\tcontextMenuItems = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: \"Add country to collection (cognate)\", handler: (e) => {\r\n\t\t\t\t\t\t\t\tconst collectionList = collections.filter((collection, i) => {\r\n\t\t\t\t\t\t\t\t\tif(collection.type === \"cognate\")\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcollection.collectionIndex = i;\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\tif(collectionList.length <= 0)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tcreateToast(e, \"You must first create a cognate collection for the node to be added to.\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tconst node = {word: \"\", language: \"\", parents: []};\r\n\t\t\t\t\t\t\t\t\tnode.fillColour = \"#FF0000\"; node.strokeColour = \"#000000\";\r\n\t\t\t\t\t\t\t\t\tnode.label = {type: \"word\", customText: \"\", fontColour: \"#000000\", fontSize: null, x: null, y: null};\r\n\t\t\t\t\t\t\t\t\topenModal(e, <AddEditNodeModal isNewWord={true} onNodeSubmit={addNode} node={node} type={\"cognate\"} collectionList={collectionList} collectionIndex={collectionList[0].collectionIndex} language={d.properties.languages} />);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Common to both\r\n\t\t\t\tcontextMenuItems.unshift(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: \"Add new node (journey)\", handler: (e) => {\r\n\t\t\t\t\t\t\tconst collectionList = collections.filter((collection, i) => {\r\n\t\t\t\t\t\t\t\tif(collection.type === \"journey\")\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tcollection.collectionIndex = i;\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tif(collectionList.length <= 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcreateToast(e, \"You must first create a journey collection for the node to be added to.\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// Open the AddEditNodeModal with initial node data\r\n\t\t\t\t\t\t\t\tconst node = {word: \"\", language: d.properties.languages[0], parents: []};\r\n\t\t\t\t\t\t\t\tnode.vertex = {type: \"word\", customText: \"\", fontColour: \"#000000\", strokeColour: \"#000000\", fillColour: \"#FFFFFF\", radius: null, fontSize: null, x: null, y: null, edgeStart: \"centre\", edgeEnd: \"centre\", edgeStrokeColour: \"#000000\", edgeStrokeWidth: \"2px\", edgeArrowheadEnabled: true, edgeArrowheadStrokeColour: \"#000000\", edgeArrowheadFillColour: \"#000000\"};\r\n\t\t\t\t\t\t\t\topenModal(e, <AddEditNodeModal isNewWord={true} node={node} type={\"journey\"} onNodeSubmit={addNode} collectionList={collectionList} collectionIndex={collectionList[0].collectionIndex} language={d.properties.languages} />);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t\topenContextMenu(e, <ContextMenu x={e.clientX} y={e.clientY} items={contextMenuItems} />);\r\n\t\t\t})\r\n\t\t\t.on(\"mouseover\", function(e, d){\r\n\t\t\t\tconst element = d3.select(this);\r\n\t\t\t\tif(element.attr(\"fill\") === \"white\") // White can't become transparent\r\n\t\t\t\t\telement.attr(\"fill\", \"rgb(230,230,230)\")\r\n\t\t\t\telse\r\n\t\t\t\t\telement.attr(\"fill-opacity\", \"0.65\");\r\n\t\t\t})\r\n\t\t\t.on(\"mouseout\", function(e, d){\r\n\t\t\t\tconst element = d3.select(this);\r\n\t\t\t\tif(element.attr(\"fill\") === \"rgb(230,230,230)\") // Reset white\r\n\t\t\t\t\telement.attr(\"fill\", \"white\")\r\n\t\t\t\telse\r\n\t\t\t\t\telement.attr(\"fill-opacity\", \"1\");\r\n\t\t\t});\r\n\r\n\t\t// Cognate labels, journey vertices\r\n\t\tconst edgesGroup = svg.append(\"g\").classed(\"edges\", true); // SVG group for edges\r\n\t\tedgesGroup.on(\"contextmenu\", (e) => e.preventDefault());\r\n\t\tconst verticesLabelsGroup = svg.append(\"g\").classed(\"vertices-labels\", true); // SVG group for vertices AND cognate labels\r\n\t\tcountryPaths.each(function(f, i) {\r\n\t\t\tconst cognateNodeObject = findNodes(f, \"cognate\");  // The first node in any cognate collection that belongs to this country/region\r\n\t\t\tif(cognateNodeObject)\r\n\t\t\t{\r\n\t\t\t\t/* Cognate visualisations */\r\n\t\t\t\tconst node = cognateNodeObject.node;\r\n\t\t\t\tconst languageProp = getLanguageProp(node);\r\n\t\t\t\tconst boundingBox = d3.select(this).node().getBBox(); // Get rectangular bounds of country/region\r\n\t\t\t\tlet fontSize = node.label.fontSize;                 // Font size of the label\r\n\t\t\t\tlet labelText = node.word;                          // Word by default\r\n\t\t\t\tif(node.label.type === \"Country/region\") labelText = f.properties.name_long;\r\n\t\t\t\telse if(node.label.type === \"Custom text\") labelText = node.label.customText;\r\n\t\t\t\telse if(node.label.type === \"Language\") labelText = node.language;\r\n\r\n\t\t\t\t// Initial scale factor depending on size of country (to stop oversized text from escaping country)\r\n\t\t\t\tif(labelText.length !== 0 && !node.label.fontSize) // Only scale if font size hasn't been set by user\r\n\t\t\t\t{\r\n\t\t\t\t\tif(boundingBox.width < (labelText.length * 16))\r\n\t\t\t\t\t\tfontSize = boundingBox.width/8 + \"px\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Initial co-ordinates\r\n\t\t\t\tlet x = (node.label.x === null) ? (languageProp.x + 612) : node.label.x;\r\n\t\t\t\tlet y = (node.label.y === null) ? (languageProp.y + 528) : node.label.y;\r\n\t\t\t\tconst label = verticesLabelsGroup.append(\"text\")\r\n\t\t\t\t\t.attr(\"x\", x).attr(\"y\", y)\r\n\t\t\t\t\t.attr(\"fill\", node.label.fontColour)\r\n\t\t\t\t\t.attr(\"font-family\", \"'Segoe UI', sans-serif\")\r\n\t\t\t\t\t.style(\"font-size\", fontSize)\r\n\t\t\t\t\t.text(labelText);\r\n\r\n\t\t\t\t// Dragging/resizing handlers\r\n\t\t\t\tlet startXOffset, startYOffset, resizing = false, startX, startY, startSize, newSize;\r\n\t\t\t\tlabel\r\n\t\t\t\t\t.on(\"mousemove\", (e) => {\r\n\t\t\t\t\t\tconst labelX = parseFloat(label.attr(\"x\")), labelY = parseFloat(label.attr(\"y\"));\r\n\t\t\t\t\t\tconst mouseX = e.layerX, mouseY = e.layerY;\r\n\r\n\t\t\t\t\t\t// Determine corner of text's box\r\n\t\t\t\t\t\tconst southEastCorner = {\r\n\t\t\t\t\t\t\txStart: labelX + label.node().getBBox().width - 5,\r\n\t\t\t\t\t\t\txEnd: labelX + label.node().getBBox().width + 15,\r\n\t\t\t\t\t\t\tyStart: labelY,\r\n\t\t\t\t\t\t\tyEnd: labelY + 10\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check corner\r\n\t\t\t\t\t\tif(mouseX >= southEastCorner.xStart && mouseX <= southEastCorner.xEnd\r\n\t\t\t\t\t\t\t&& mouseY >= southEastCorner.yStart && mouseY <= southEastCorner.yEnd)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel.style(\"cursor\", \"se-resize\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tlabel.style(\"cursor\", \"grab\");\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.call(d3.drag()\r\n\t\t\t\t\t\t.on(\"start\", (e) => {\r\n\t\t\t\t\t\t\tconst labelX = parseFloat(label.attr(\"x\")), labelY = parseFloat(label.attr(\"y\"));\r\n\t\t\t\t\t\t\tconst mouseX = e.x, mouseY = e.y;\r\n\t\t\t\t\t\t\tstartXOffset = mouseX - labelX;\r\n\t\t\t\t\t\t\tstartYOffset = mouseY - labelY;\r\n\r\n\t\t\t\t\t\t\t// Determine corner of text's box\r\n\t\t\t\t\t\t\tconst southEastCorner = {\r\n\t\t\t\t\t\t\t\txStart: labelX + label.node().getBBox().width - 5,\r\n\t\t\t\t\t\t\t\txEnd: labelX + label.node().getBBox().width + 15,\r\n\t\t\t\t\t\t\t\tyStart: labelY,\r\n\t\t\t\t\t\t\t\tyEnd: labelY + 10\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Check corner\r\n\t\t\t\t\t\t\tif(mouseX >= southEastCorner.xStart && mouseX <= southEastCorner.xEnd\r\n\t\t\t\t\t\t\t\t&& mouseY >= southEastCorner.yStart && mouseY <= southEastCorner.yEnd)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tresizing = true;\r\n\t\t\t\t\t\t\t\tstartX = mouseX;\r\n\t\t\t\t\t\t\t\tstartY = mouseY;\r\n\t\t\t\t\t\t\t\tstartSize = parseFloat(label.style(\"font-size\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"drag\", (e) => {\r\n\t\t\t\t\t\t\tconst mouseX = e.x, mouseY = e.y;\r\n\t\t\t\t\t\t\tif(resizing)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// Resize the label\r\n\t\t\t\t\t\t\t\tif(mouseX >= startX && mouseY >= startY || mouseX <= startX && mouseY <= startY)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tconst deltaX = mouseX - startX;\r\n\t\t\t\t\t\t\t\t\tnewSize = startSize + (deltaX / 10);\r\n\t\t\t\t\t\t\t\t\tif(newSize < 5) newSize = 5; // Floor of 5px to prevent it shrinking into nothingness\r\n\t\t\t\t\t\t\t\t\tlabel.style(\"font-size\", newSize + \"px\"); // Only visually, not updating state itself\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// Move the label\r\n\t\t\t\t\t\t\t\tx = mouseX - startXOffset;\r\n\t\t\t\t\t\t\t\ty = mouseY - startYOffset;\r\n\t\t\t\t\t\t\t\tnewSize = node.label.fontSize;\r\n\t\t\t\t\t\t\t\tlabel.attr(\"x\", x).attr(\"y\", y); // Only visually\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"end\", () => {\r\n\t\t\t\t\t\t\tresizing = false;\r\n\t\t\t\t\t\t\tnode.label.x = x; node.label.y = y; node.label.fontSize = newSize;\r\n\t\t\t\t\t\t\teditNode(null, cognateNodeObject.collectionIndex, node);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Journeys\r\n\t\tconst journeyNodeObjects = findNodes(null, \"journey\");\r\n\t\tif(journeyNodeObjects)\r\n\t\t{\r\n\t\t\t/* Journey visualisations */\r\n\r\n\t\t\t// Loop through all journey nodes inside this country/region\r\n\t\t\tlet startEdgeXOffset = 0, startEdgeYOffset = 0, endEdgeXOffset = 0, endEdgeYOffset = 0; // Centre by default\r\n\t\t\tfor(let i = 0; i < journeyNodeObjects.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tconst journeyNodeObject = journeyNodeObjects[i];\r\n\t\t\t\tconst node = journeyNodeObject.node;\r\n\t\t\t\tconst languageProp = getLanguageProp(node);\r\n\t\t\t\tlet radius = node.vertex.radius || languageProp.radius || 50; // Inherit radius (determined later if null)\r\n\t\t\t\tconst fontSize = node.vertex.fontSize;\r\n\t\t\t\tlet vertexText = node.word;  // Word by default\r\n\t\t\t\tif(node.vertex.type === \"Custom text\") vertexText = node.vertex.customText;\r\n\t\t\t\telse if(node.vertex.type === \"Language\") vertexText = node.language;\r\n\r\n\t\t\t\t/* Build node elements - VERTEX */\r\n\r\n\t\t\t\t// Initial co-ordinates\r\n\t\t\t\tlet vertexX = (node.vertex.x === null) ? (languageProp.x + 612) : node.vertex.x;\r\n\t\t\t\tlet vertexY = (node.vertex.y === null) ? (languageProp.y + 528) : node.vertex.y;\r\n\r\n\t\t\t\t// Set initial vertex position\r\n\t\t\t\tif(!node.vertex.x || !node.vertex.y)\r\n\t\t\t\t{\r\n\t\t\t\t\tnode.vertex.x = vertexX; node.vertex.y = vertexY;\r\n\t\t\t\t\treturn editNode(null, journeyNodeObject.collectionIndex, node); // Performance TODO: Make this a bulk update instead to prevent re-rendering loop\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Prepare text element. This is required to calculate circle radius based on text element's width\r\n\t\t\t\tconst vertexG = verticesLabelsGroup.append(\"g\"); // Group required to have circle and text together\r\n\t\t\t\tconst preparedText = vertexG.append(\"text\")\r\n\t\t\t\t\t.attr(\"x\", vertexX).attr(\"y\", vertexY)\r\n\t\t\t\t\t.attr(\"fill\", node.vertex.fontColour)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")        // Centre of circle\r\n\t\t\t\t\t.attr(\"alignment-baseline\", \"middle\") // Centre of circle\r\n\t\t\t\t\t.attr(\"font-family\", \"'Segoe UI', sans-serif\")\r\n\t\t\t\t\t.style(\"font-size\", \"16px\")\r\n\t\t\t\t\t.text(vertexText);\r\n\r\n\t\t\t\t// Determine initial radius of circle\r\n\t\t\t\tconst innerTextWidth = preparedText.node().getBBox().width;\r\n\t\t\t\tif(vertexText.length !== 0 && !node.vertex.radius) // Only scale if font size hasn't been set by user\r\n\t\t\t\t{\r\n\t\t\t\t\tif(radius < innerTextWidth) radius = innerTextWidth/2 + 5; // Convert text \"diameter\" to radius, add padding\r\n\t\t\t\t}\r\n\t\t\t\tpreparedText.remove(); // Remove prepared text element. It will not show if appended before the circle\r\n\r\n\t\t\t\t/* Build node elements - EDGE */\r\n\r\n\t\t\t\t// Place edge between this node and its parents\r\n\t\t\t\tlet markerSelectString = \"\"; // String to select markers so that they can move whilst being resized\r\n\t\t\t\tif(node.parents)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Create edge for each parent, originating from this node\r\n\t\t\t\t\tfor(let i = 0; i < node.parents.length; ++i)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst parentNode = node.parents[i];\r\n\r\n\t\t\t\t\t\t// Fingerprint references for marker IDs and data-start/data-end attributes\r\n\t\t\t\t\t\tconst parentRef = journeyNodeObject.collectionIndex + \"|\" + parentNode.arrayIndex;\r\n\t\t\t\t\t\tconst nodeRef = journeyNodeObject.collectionIndex + \"|\" + node.arrayIndex;\r\n\r\n\t\t\t\t\t\t// Compute arrowheads\r\n\t\t\t\t\t\tif(node.vertex.edgeArrowheadEnabled)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tedgesGroup.append(\"defs\")\r\n\t\t\t\t\t\t\t\t.append(\"marker\")\r\n\t\t\t\t\t\t\t\t.attr(\"id\", \"arrow\" + parentRef + nodeRef)\r\n\t\t\t\t\t\t\t\t.attr(\"markerWidth\", 5).attr(\"markerHeight\", 4)\r\n\t\t\t\t\t\t\t\t.attr(\"refX\", radius/2 + 5).attr(\"refY\", 2)\r\n\t\t\t\t\t\t\t\t.attr(\"orient\", \"auto\")\r\n\t\t\t\t\t\t\t\t.append(\"polygon\")\r\n\t\t\t\t\t\t\t\t.attr(\"points\", \"0 0, 5 2, 0 4\")\r\n\t\t\t\t\t\t\t\t.attr(\"fill\", node.vertex.edgeArrowheadFillColour)\r\n\t\t\t\t\t\t\t\t.attr(\"stroke\", node.vertex.edgeArrowheadStrokeColour)\r\n\t\t\t\t\t\t\t\t.attr(\"id\", nodeRef);\r\n\t\t\t\t\t\t\tmarkerSelectString += \"marker[id=\\\"arrow\"+parentRef+nodeRef+\"\\\"], \";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Determine edge start position\r\n\t\t\t\t\t\tif(node.vertex.edgeStart === \"top\") startEdgeYOffset = -(radius);\r\n\t\t\t\t\t\telse if(node.vertex.edgeStart === \"right\") startEdgeXOffset = radius;\r\n\t\t\t\t\t\telse if(node.vertex.edgeStart === \"bottom\") startEdgeYOffset = radius;\r\n\t\t\t\t\t\telse if(node.vertex.edgeStart === \"left\") startEdgeXOffset = -(radius);\r\n\t\t\t\t\t\telse if(node.vertex.edgeStart === \"centre\") {\r\n\t\t\t\t\t\t\tstartEdgeXOffset = 0; startEdgeYOffset = 0;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Determine edge end position\r\n\t\t\t\t\t\tif(node.vertex.edgeEnd === \"top\") endEdgeYOffset = -(radius);\r\n\t\t\t\t\t\telse if(node.vertex.edgeEnd === \"right\") endEdgeXOffset = radius;\r\n\t\t\t\t\t\telse if(node.vertex.edgeEnd === \"bottom\") endEdgeYOffset = radius;\r\n\t\t\t\t\t\telse if(node.vertex.edgeEnd === \"left\") endEdgeXOffset = -(radius);\r\n\t\t\t\t\t\telse if(node.vertex.edgeStart === \"centre\") {\r\n\t\t\t\t\t\t\tendEdgeXOffset = 0; endEdgeYOffset = 0;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Place edge\r\n\t\t\t\t\t\tconst edge = edgesGroup.append(\"line\")\r\n\t\t\t\t\t\t\t.attr(\"x1\", parentNode.vertex.x + startEdgeXOffset)\r\n\t\t\t\t\t\t\t.attr(\"y1\", parentNode.vertex.y + startEdgeYOffset)\r\n\t\t\t\t\t\t\t.attr(\"x2\", node.vertex.x + endEdgeXOffset)\r\n\t\t\t\t\t\t\t.attr(\"y2\", node.vertex.y + endEdgeYOffset)\r\n\t\t\t\t\t\t\t.attr(\"stroke\", node.vertex.edgeStrokeColour)\r\n\t\t\t\t\t\t\t.attr(\"stroke-width\", node.vertex.edgeStrokeWidth)\r\n\t\t\t\t\t\t\t.attr(\"data-start\", parentRef) // For finding attached edges later\r\n\t\t\t\t\t\t\t.attr(\"data-end\", nodeRef);\r\n\r\n\t\t\t\t\t\tif(node.vertex.edgeArrowheadEnabled)\r\n\t\t\t\t\t\t\tedge.attr(\"marker-end\", \"url(#arrow\"+parentRef+nodeRef+\")\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Place node elements\r\n\t\t\t\tconst vertex = vertexG.append(\"circle\")\r\n\t\t\t\t\t.attr(\"cx\", vertexX).attr(\"cy\", vertexY)\r\n\t\t\t\t\t.attr(\"r\", radius + \"px\")\r\n\t\t\t\t\t.attr(\"stroke\", node.vertex.strokeColour)\r\n\t\t\t\t\t.attr(\"fill\", node.vertex.fillColour);\r\n\t\t\t\tconst text = vertexG.append(\"text\")\r\n\t\t\t\t\t.attr(\"x\", vertexX).attr(\"y\", vertexY)\r\n\t\t\t\t\t.attr(\"fill\", node.vertex.fontColour)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")        // Centre of circle\r\n\t\t\t\t\t.attr(\"alignment-baseline\", \"middle\") // Centre of circle\r\n\t\t\t\t\t.attr(\"font-family\", \"'Segoe UI', sans-serif\")\r\n\t\t\t\t\t.style(\"font-size\", fontSize)\r\n\t\t\t\t\t.text(vertexText);\r\n\r\n\t\t\t\t/* Dragging/resizing/clicking handlers */\r\n\t\t\t\tlet startXOffset, startYOffset, resizing = false, startX, startY, startRadius, newVertexRadius, newLabelSize;\r\n\t\t\t\tconst nodeContextMenuHandler = (e) => {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tconst contextMenuItems = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: \"Edit node\", handler: (e) => {\r\n\t\t\t\t\t\t\t\tconst collectionList = collections.filter((collection, i) => {\r\n\t\t\t\t\t\t\t\t\tif(collection.type === \"journey\")\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcollection.collectionIndex = i;\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\topenModal(e, <AddEditNodeModal onNodeSubmit={editNode} node={node} collectionList={collectionList}\r\n\t\t\t\t\t\t\t\t                               collectionIndex={journeyNodeObject.collectionIndex} language={node.language}\r\n\t\t\t\t\t\t\t\t                               type={\"journey\"} words={collectionList[journeyNodeObject.collectionIndex].words}  />);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: \"Remove node\", handler: (e) => {\r\n\t\t\t\t\t\t\t\tremoveNode(e, journeyNodeObject.collectionIndex, node.arrayIndex);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t\topenContextMenu(e, <ContextMenu x={e.clientX} y={e.clientY} items={contextMenuItems} />);\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Dimensions of bottom-right corner\r\n\t\t\t\tconst squareArea = vertex.node().getBBox().width * vertex.node().getBBox().height;\r\n\t\t\t\tconst circleArea = Math.PI * Math.pow(parseFloat(vertex.attr(\"r\")),2);\r\n\t\t\t\tconst cornerWidth = ((squareArea - circleArea) / 4) / 2; // Extract corners, divide by four, width and height are equal length (/2)\r\n\r\n\t\t\t\t// Determine corner of circle's box\r\n\t\t\t\tconst southEastCorner = {\r\n\t\t\t\t\txStart: vertexX,\r\n\t\t\t\t\txEnd: vertexX + cornerWidth,\r\n\t\t\t\t\tyStart: vertexY,\r\n\t\t\t\t\tyEnd: vertexY + cornerWidth\r\n\t\t\t\t}\r\n\t\t\t\tlet hoveringOverText = false;\r\n\t\t\t\tconst nodeDragHandler = d3.drag()\r\n\t\t\t\t\t.on(\"start\", (e) => {\r\n\t\t\t\t\t\tconst vertexX = parseFloat(vertex.attr(\"cx\")), vertexY = parseFloat(vertex.attr(\"cy\"));\r\n\t\t\t\t\t\tconst mouseX = e.x, mouseY = e.y;\r\n\t\t\t\t\t\tstartX = vertexX;\r\n\t\t\t\t\t\tstartY = vertexY;\r\n\t\t\t\t\t\tstartXOffset = mouseX - vertexX;\r\n\t\t\t\t\t\tstartYOffset = mouseY - vertexY;\r\n\r\n\t\t\t\t\t\t// Check corner\r\n\t\t\t\t\t\tif(mouseX >= southEastCorner.xStart && mouseX <= southEastCorner.xEnd\r\n\t\t\t\t\t\t\t&& mouseY >= southEastCorner.yStart && mouseY <= southEastCorner.yEnd\r\n\t\t\t\t\t\t\t&& !hoveringOverText)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tresizing = true;\r\n\t\t\t\t\t\t\tstartX = mouseX;\r\n\t\t\t\t\t\t\tstartY = mouseY;\r\n\t\t\t\t\t\t\tstartRadius = parseFloat(vertex.attr(\"r\"));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"drag\", (e) => {\r\n\t\t\t\t\t\tconst mouseX = e.x, mouseY = e.y;\r\n\t\t\t\t\t\tif(resizing)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(mouseX >= startX && mouseY >= startY || mouseX <= startX && mouseY <= startY)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// Resize the vertex\r\n\t\t\t\t\t\t\t\tconst deltaX = mouseX - startX;\r\n\t\t\t\t\t\t\t\tnewVertexRadius = startRadius + (deltaX / 10);\r\n\t\t\t\t\t\t\t\tif(newVertexRadius < 10) newVertexRadius = 10; // Floor of 10px to prevent it shrinking into nothingness\r\n\t\t\t\t\t\t\t\tvertex.attr(\"r\", newVertexRadius + \"px\"); // Only visually, not updating state itself\r\n\r\n\t\t\t\t\t\t\t\t// Resize the vertex's text\r\n\t\t\t\t\t\t\t\tconst paddingOffset = 10;\r\n\t\t\t\t\t\t\t\tnewLabelSize = ((((newVertexRadius*2) - paddingOffset) / innerTextWidth) * 100) + \"%\";\r\n\t\t\t\t\t\t\t\ttext.style(\"font-size\", newLabelSize);\r\n\r\n\t\t\t\t\t\t\t\t// Move arrowheads as it is resized\r\n\t\t\t\t\t\t\t\tif(markerSelectString)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tconst selectString = markerSelectString.slice(0, markerSelectString.length-2); // Trim \", \" at the end of string\r\n\t\t\t\t\t\t\t\t\td3.selectAll(selectString).attr(\"refX\", newVertexRadius/2+5);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Move the vertex\r\n\t\t\t\t\t\t\tvertexX = mouseX - startXOffset;\r\n\t\t\t\t\t\t\tvertexY = mouseY - startYOffset;\r\n\t\t\t\t\t\t\tvertex.attr(\"cx\", vertexX).attr(\"cy\", vertexY); // Only visually\r\n\t\t\t\t\t\t\ttext.attr(\"x\", vertexX).attr(\"y\", vertexY); // Only visually\r\n\r\n\t\t\t\t\t\t\t// Move the edges\r\n\t\t\t\t\t\t\tconst dataEnd = journeyNodeObject.collectionIndex + \"|\" + journeyNodeObject.node.arrayIndex;\r\n\t\t\t\t\t\t\tconst attachedEdges = d3.selectAll(\"line[data-start=\\\"\"+dataEnd+\"\\\"]\"); // Find all edges that start on this node\r\n\t\t\t\t\t\t\tconst attachedEdges2 = d3.selectAll(\"line[data-end=\\\"\"+dataEnd+\"\\\"]\");  // Find all edges that end on this node\r\n\t\t\t\t\t\t\tif(attachedEdges)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tattachedEdges.attr(\"x1\", vertexX + startEdgeXOffset)\r\n\t\t\t\t\t\t\t\t\t.attr(\"y1\", vertexY + startEdgeYOffset);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(attachedEdges2)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tattachedEdges2.attr(\"x2\", vertexX + startEdgeXOffset)\r\n\t\t\t\t\t\t\t\t\t.attr(\"y2\", vertexY + startEdgeYOffset);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"end\", () => {\r\n\t\t\t\t\t\tresizing = false;\r\n\t\t\t\t\t\tnode.vertex.x = vertexX; node.vertex.y = vertexY; node.vertex.radius = newVertexRadius || node.vertex.radius; node.vertex.fontSize = newLabelSize || node.vertex.fontSize;\r\n\t\t\t\t\t\teditNode(null, journeyNodeObject.collectionIndex, node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t// Assign handlers\r\n\t\t\t\ttext.on(\"contextmenu\", nodeContextMenuHandler);\r\n\t\t\t\ttext.call(nodeDragHandler);\r\n\t\t\t\ttext.on(\"mousemove\", () => {\r\n\t\t\t\t\ttext.style(\"cursor\", \"grab\");\r\n\t\t\t\t\thoveringOverText = true;\r\n\t\t\t\t});\r\n\t\t\t\tvertex.on(\"mousemove\", (e) => {\r\n\t\t\t\t\thoveringOverText = false;\r\n\t\t\t\t\tconst mouseX = e.layerX, mouseY = e.layerY;\r\n\r\n\t\t\t\t\t// Check corner\r\n\t\t\t\t\tif(mouseX >= southEastCorner.xStart && mouseX <= southEastCorner.xEnd\r\n\t\t\t\t\t\t&& mouseY >= southEastCorner.yStart && mouseY <= southEastCorner.yEnd)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvertex.style(\"cursor\", \"se-resize\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tvertex.style(\"cursor\", \"grab\");\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"contextmenu\", nodeContextMenuHandler)\r\n\t\t\t\t.call(nodeDragHandler);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Graticules (lines on the map)\r\n\t\tconst g = svg.append(\"g\");\r\n\t\tconst graticules = g.classed(\"graticules\", true)\r\n\t\t\t.append(\"path\")\r\n\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t.attr(\"stroke\", \"rgba(0,0,0,.2)\")\r\n\t\t\t.attr(\"d\", path(d3.geoGraticule()()));\r\n\r\n\t\t/*\r\n\t\tsvg.call(d3.zoom().on(\"zoom\", function () {\r\n\t\t\tz = d3.event.transform.k;\r\n\t\t\tdraw(); // TODO: Contain above render code into draw() function\r\n\t\t}));\r\n\t\t */\r\n\r\n\t\t// Clean-up function (kills all SVG elements upon unmounting)\r\n\t\treturn function cleanup()\r\n\t\t{\r\n\t\t\tsvg.selectAll(\"g\").remove();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tfunction getLanguageProp(node)\r\n\t{\r\n\t\tfor(const l in languageProperties)\r\n\t\t{\r\n\t\t\tconst languageProp = languageProperties[l];\r\n\t\t\tif(languageProp.language === node.language)\r\n\t\t\t\treturn languageProp;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\t\"language\": node.language,\r\n\t\t\t\"x\": 0,\r\n\t\t\t\"y\": 0,\r\n\t\t\t\"width\": 0,\r\n\t\t\t\"height\": 0,\r\n\t\t\t\"radius\": 25\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finds all nodes in all collections of specified type where the node's language is within the feature's language array\r\n\t * @param {*} d The dataset feature (country/region) currently being rendered\r\n\t * @param {string} type The type of collection to search for (\"journey\" or \"cognate\")\r\n\t */\r\n\tfunction findNodes(d, type)\r\n\t{\r\n\t\t// Search collections\r\n\t\tif(type === \"cognate\")\r\n\t\t{\r\n\t\t\tfor(let c = 0; c < collections.length; ++c)\r\n\t\t\t{\r\n\t\t\t\tconst collection = collections[c];\r\n\t\t\t\tif(collection.type === \"cognate\")\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(let n = 0; n < collection.words.length; ++n)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst childNode = collection.words[n];\r\n\r\n\t\t\t\t\t\tif(d.properties.languages.includes(childNode.language))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn {node: childNode, collectionIndex: c, arrayIndex: n}; // TODO: Currently only returns first cognate\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(type === \"journey\")\r\n\t\t{\r\n\t\t\tconst journeyNodeObjects = [];\r\n\t\t\tfor(let c = 0; c < collections.length; ++c) // Search for all nodes in all journey collections\r\n\t\t\t{\r\n\t\t\t\tconst collection = collections[c];\r\n\t\t\t\tif(collection.type === \"journey\")\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(let n = 0; n < collection.words.length; ++n)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst childNode = collection.words[n];\r\n\t\t\t\t\t\tjourneyNodeObjects.push({node: childNode, collectionIndex: c});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn journeyNodeObjects;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Determines country SVG fill colour according to countries' language(s) and the specified colour of that language's cognate node(s).\r\n\t * @param d Data attached to DOM element via D3 (i.e. the country).\r\n\t * @returns {string} The fill colour, as specified by user in Collection.jsx.\r\n\t */\r\n\tfunction determineFillColour(d)\r\n\t{\r\n\t\tconst nodeObject = findNodes(d, \"cognate\"); // Find node in collections\r\n\t\tif(nodeObject) return nodeObject.node.fillColour;    // Country has associated collection node? Return the colour\r\n\t\telse return \"white\";                             // Otherwise, return white by default for all countries with no associated data\r\n\t}\r\n\t/**\r\n\t * Determines country SVG stroke colour according to countries' language(s) and the specified colour of that language's cognate node(s).\r\n\t * @param d Data attached to DOM element via D3 (i.e. the country).\r\n\t * @returns {string} The fill colour, as specified by user in Collection.jsx.\r\n\t */\r\n\tfunction determineStrokeColour(d)\r\n\t{\r\n\t\tconst nodeObject = findNodes(d, \"cognate\");       // Find node in collections\r\n\t\tif(nodeObject) return nodeObject.node.strokeColour;    // Country has associated collection node? Return the colour\r\n\t\telse return \"black\";                                   // Otherwise, return black by default for all countries with no associated data\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className={\"map-container\"}>\r\n\t\t\t<svg\r\n\t\t\t\t/*ref={ref}*/\r\n\t\t\t\tid={\"map-svg\"}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\theight: \"100%\",\r\n\t\t\t\t\twidth: \"100%\",\r\n\t\t\t\t\tmargin: 0\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<rect width={\"100%\"} height={\"100%\"} fill={\"#3d73ab\"}/>\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t);\r\n}\r\n","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Banner.jsx",["135"],"import {Component} from \"react\";\r\nimport {LoginRegisterModal} from \"./modals/LoginRegisterModal\";\r\nimport {SaveModal} from \"./modals/SaveModal\";\r\nimport {ViewMapsModal} from \"./modals/ViewMapsModal\";\r\nimport {ProfileSettingsModal} from \"./modals/ProfileSettingsModal\";\r\nimport {GenericModal} from \"./modals/GenericModal\";\r\n\r\nexport class Banner extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst showcaseText = (this.props.isShowcaseMode) ? \"Hide Community Showcase\" : \"Show Community Showcase\";\r\n\t\tconst showcase =\r\n\t\t\t<div className={\"showcase-button\"} onClick={(e) => {\r\n\t\t\t\tthis.props.toggleShowcaseMode(e);\r\n\t\t\t}}>\r\n\t\t\t\t{showcaseText}\r\n\t\t\t</div>;\r\n\r\n\t\tlet buttons = [\r\n\t\t\t<div className={\"new-map-button\"} onClick={(e) => {\r\n\t\t\t\tconst userConfirmed = window.confirm(\"This will wipe your currently active map so that you can start from scratch.\\n\" +\r\n\t\t\t\t\t\"You should save/export your map first if you wish to save your progress.\\n\\nDo you wish to continue?\");\r\n\t\t\t\tif(userConfirmed) this.props.newMap(e);\r\n\t\t\t}}>\r\n\t\t\t\tNew Map\r\n\t\t\t</div>,\r\n\t\t\t<div className={\"login-button\"} onClick={(e) => {\r\n\t\t\t\tthis.props.openModal(e, <LoginRegisterModal mode={\"login\"} handler={this.props.authenticateUser} createToast={this.props.createToast} />);\r\n\t\t\t}}>\r\n\t\t\t\tLog In\r\n\t\t\t</div>,\r\n\t\t\t<div className={\"register-button\"} onClick={(e) => {\r\n\t\t\t\tthis.props.openModal(e, <LoginRegisterModal mode={\"register\"} handler={this.props.registerUser} openModal={this.props.openModal} createToast={this.props.createToast} />);\r\n\t\t\t}}>\r\n\t\t\t\tRegister\r\n\t\t\t</div>\r\n\t\t];\r\n\t\tif(this.props.activeUser)\r\n\t\t{\r\n\t\t\tbuttons = [\r\n\t\t\t\t<div className={\"new-map-button\"} onClick={(e) => {\r\n\t\t\t\t\tconst userConfirmed = window.confirm(\"This will wipe your currently active map so that you can start from scratch.\\n\" +\r\n\t\t\t\t\t\t\"You should save/export your map first if you wish to save your progress.\\n\\nDo you wish to continue?\");\r\n\t\t\t\t\tif(userConfirmed) this.props.newMap(e);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tNew Map\r\n\t\t\t\t</div>,\r\n\t\t\t\t<div className={\"save-button\"} onClick={(e) => {\r\n\t\t\t\t\tthis.props.openModal(e, <SaveModal handler={this.props.saveMap} activeMap={this.props.activeMap} createToast={this.props.createToast} />);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tSave Map / Export\r\n\t\t\t\t</div>,\r\n\t\t\t\t<div className={\"view-maps-button\"} onClick={(e) => {\r\n\t\t\t\t\tthis.props.openModal(e, <ViewMapsModal loadMap={this.props.loadMap} deleteMap={this.props.deleteMap}\r\n\t\t\t\t\t                                       activeUser={this.props.activeUser} openModal={this.props.openModal}\r\n\t\t\t\t\t                                       handleResponse={this.props.handleResponse}  />);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tView Maps / Import\r\n\t\t\t\t</div>,\r\n\t\t\t\t<div className={\"share-button\"} onClick={(e) => {\r\n\t\t\t\t\tif(this.props.activeMap)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(this.props.activeMap.mapID)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst domain = \"http://localhost:3000/\"; // Major TODO: Update this when hosted\r\n\t\t\t\t\t\t\tconst link = `${domain}/map/${this.props.activeUser.username}/${this.props.activeMap.mapID}`;\r\n\t\t\t\t\t\t\tconst linkModal =\r\n\t\t\t\t\t\t\t\t<GenericModal>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\tHere is the link to your map: <a href={link}>{link}</a><br /><br />\r\n\t\t\t\t\t\t\t\t\t\tThis will not share your map to the showcase, but anybody with the link can access it.<br />\r\n\t\t\t\t\t\t\t\t\t\tWhenever you save your map, your changes will be shown via this same link.\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</GenericModal>\r\n\t\t\t\t\t\t\tthis.props.openModal(null, linkModal, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.props.createToast(e, \"Map must be saved to profile before it can be shared.\", 7000, \"error\")\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.props.createToast(e, \"No active map. Create/load a map and save it to your profile before sharing.\", 7000, \"error\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}}>\r\n\t\t\t\t\tShare\r\n\t\t\t\t</div>,\r\n\t\t\t\t<div className={\"settings-button\"} onClick={(e) => {\r\n\t\t\t\t\tthis.props.openModal(e, <ProfileSettingsModal editProfile={this.props.editProfile} deleteProfile={this.props.deleteProfile} activeUser={this.props.activeUser} createToast={this.props.createToast} />);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tProfile Settings\r\n\t\t\t\t</div>,\r\n\t\t\t\t<div className={\"logout-button\"} onClick={this.props.logoutUser}>\r\n\t\t\t\t\tLog Out\r\n\t\t\t\t</div>\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn(\r\n\t\t\t<div className={\"banner-container\"}>\r\n\t\t\t\t<h2>LEMA: Linguistic Etymology Map Assistant</h2>\r\n\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t{showcase}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t{buttons}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\CollectionArea.jsx",["136","137"],"import {Component} from \"react\";\r\nimport {Collection} from \"./Collection\";\r\nimport {Button} from \"./controls/Button\";\r\nimport {AddEditCollectionModal} from \"./modals/AddEditCollectionModal\";\r\nimport {AddEditNodeModal} from \"./modals/AddEditNodeModal\";\r\nimport {CommunityMap} from \"./CommunityMap\";\r\nimport axios from \"axios\";\r\n\r\nexport class CollectionArea extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tshowcaseMaps: []\r\n\t\t};\r\n\r\n\t\t/* Click, event handlers */\r\n\t\tthis.cAddNode = this.cAddNode.bind(this);\r\n\t\tthis.cAddNodeDefault = this.cAddNodeDefault.bind(this);\r\n\t\tthis.cRemoveCollection = this.cRemoveCollection.bind(this);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot)\r\n\t{\r\n\t\t// Retrieve shared maps\r\n\t\tif(this.props.isShowcaseMode && this.state.showcaseMaps.length <= 0)\r\n\t\t{\r\n\t\t\taxios.get(`/maps/1`).then((response) => {\r\n\t\t\t\tconsole.log(response);\r\n\t\t\t\tif(response.data.type === \"error\")\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.error(response.data.message);\r\n\t\t\t\t\tthis.props.createToast(null, response.data.message, 5000, \"error\");\r\n\t\t\t\t}\r\n\t\t\t\telse if(response.data.type === \"success\")\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(response.data);\r\n\t\t\t\t\tif(response.data.message === \"Maps retrieved.\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(prevState.showcaseMaps !== response.data.maps)\r\n\t\t\t\t\t\t\tthis.setState({showcaseMaps: response.data.maps}, () => console.log(this.state.showcaseMaps));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/* Context menu item handlers */\r\n\tcAddNode(e, data)\r\n\t{\r\n\t\t// Open the AddEditNodeModal with initial node data\r\n\t\tconst node = {word: \"\", language: \"\", parents: []};\r\n\t\tif(data.type === \"journey\")\r\n\t\t\tnode.vertex = {type: \"word\", customText: \"\", fontColour: \"#000000\", strokeColour: \"#000000\", fillColour: \"#FFFFFF\", radius: null, fontSize: null, x: null, y: null, edgeStart: \"centre\", edgeEnd: \"centre\", edgeStrokeColour: \"#000000\", edgeStrokeWidth: \"2px\", edgeArrowheadEnabled: true, edgeArrowheadStrokeColour: \"#000000\", edgeArrowheadFillColour: \"#000000\"};\r\n\t\tif(data.type === \"cognate\")\r\n\t\t{\r\n\t\t\tnode.fillColour = \"#FF0000\"; node.strokeColour = \"#000000\";\r\n\t\t\tnode.label = {type: \"word\", customText: \"\", fontColour: \"#000000\", fontSize: null, x: null, y: null};\r\n\t\t}\r\n\t\tthis.props.openModal(e, <AddEditNodeModal isNewWord={true} words={data.words} node={node} type={data.type} onNodeSubmit={this.props.addNode} collectionIndex={data.collectionIndex}/>);\r\n\t}\r\n\tcAddNodeDefault(e, data)\r\n\t{\r\n\t\t// Add node with initial node data\r\n\t\tconst node = {word: \"New Word\", language: \"Proto-Indo-European\", parents: []};\r\n\t\tif(data.type === \"journey\")\r\n\t\t\tnode.vertex = {type: \"word\", customText: \"\", fontColour: \"#000000\", strokeColour: \"#000000\", fillColour: \"#FFFFFF\", radius: null, fontSize: null, x: null, y: null, edgeStart: \"centre\", edgeEnd: \"centre\", edgeStrokeColour: \"#000000\", edgeStrokeWidth: \"2px\", edgeArrowheadEnabled: true, edgeArrowheadStrokeColour: \"#000000\", edgeArrowheadFillColour: \"#000000\"};\r\n\t\tif(data.type === \"cognate\")\r\n\t\t{\r\n\t\t\tnode.strokeColour = \"#000000\";\r\n\t\t\tnode.fillColour = \"#FF0000\";\r\n\t\t\tnode.label = {type: \"language\", customText: \"\", fontColour: \"#000000\", fontSize: null, x: null, y: null};\r\n\t\t}\r\n\r\n\t\tthis.props.addNode(e, data.collectionIndex, node);\r\n\t}\r\n\tcRemoveCollection(e, collectionIndex)\r\n\t{\r\n\t\tthis.props.removeCollection(e, collectionIndex);\r\n\t}\r\n\r\n\r\n\trender()\r\n\t{\r\n\t\tlet journeys, cognates, header, output = [];\r\n\t\tconst journeyCollections = [], cognateCollections = [], showcaseMaps = [];\r\n\r\n\t\tif(this.props.isShowcaseMode)\r\n\t\t{\r\n\t\t\t// Collection area header\r\n\t\t\theader = <h3>Shared Maps</h3>;\r\n\r\n\t\t\t// Add maps header to array\r\n\t\t\tshowcaseMaps.push(\r\n\t\t\t\t<div className={\"showcase-header\"}>\r\n\t\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// TODO: Sort by title\r\n\t\t\t\t\t}}>Title</div>\r\n\t\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// TODO: Sort by description, I guess\r\n\t\t\t\t\t}}>Description</div>\r\n\t\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// TODO: Sort by... owner?\r\n\t\t\t\t\t}}>Owner</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\r\n\t\t\t// Build list of shared maps\r\n\t\t\tconsole.log(this.state.showcaseMaps);\r\n\t\t\tthis.state.showcaseMaps.map((map, index) =>\r\n\t\t\t{\r\n\t\t\t\tif(typeof map !== \"undefined\" && map.activeMap)\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(map);\r\n\t\t\t\t\tshowcaseMaps.push(<CommunityMap key={index} mapID={map.activeMap.mapID} title={map.activeMap.title} description={map.activeMap.description} owner={map.activeMap.owner} />);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\toutput =\r\n\t\t\t\t<div className={\"showcase-container\"}>\r\n\t\t\t\t\t{showcaseMaps}\r\n\t\t\t\t</div>;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// Build header\r\n\t\t\tconst headerText = (this.props.activeMap) ? this.props.activeMap.title : \"Collection Area\";\r\n\t\t\tconst headerDescription = (this.props.activeMap)\r\n\t\t\t\t? <div className={\"description\"}>{this.props.activeMap.description}</div>\r\n\t\t\t\t: null;\r\n\t\t\tconst mapID = (this.props.activeMap) ?\r\n\t\t\t\t(this.props.activeMap.mapID !== null) ?\r\n\t\t\t\t\t<div className={\"id\"}> Attached to profile (ID: {this.props.activeMap.mapID})</div> :\r\n\t\t\t\t\t<div className={\"id\"}> Loaded from file or link</div>\r\n\t\t\t\t: \"\";\r\n\t\t\theader = <h3>{headerText}{headerDescription}{mapID}</h3>;\r\n\r\n\t\t\tthis.props.collections.map((collection, index) =>\r\n\t\t\t{\r\n\t\t\t\tif(typeof collection !== \"undefined\")\r\n\t\t\t\t{\r\n\t\t\t\t\tconst component = <Collection\r\n\t\t\t\t\t\tcollections={this.props.collections} createToast={this.props.createToast}\r\n\t\t\t\t\t\tkey={index} index={index} type={collection.type} header={collection.header} openModal={this.props.openModal}\r\n\t\t\t\t\t\twords={collection.words} editCollection={this.props.editCollection}\r\n\t\t\t\t\t\topenContextMenu={this.props.openContextMenu} closeContextMenu={this.props.closeContextMenu}\r\n\t\t\t\t\t\tcAddNode={this.cAddNode} cAddNodeDefault={this.cAddNodeDefault} cRemoveCollection={this.cRemoveCollection}\r\n\t\t\t\t\t\taddNode={this.props.addNode} editNode={this.props.editNode} removeNode={this.props.removeNode}\r\n\t\t\t\t\t/>;\r\n\t\t\t\t\tif(collection.type === \"journey\")\r\n\t\t\t\t\t\tjourneyCollections.push(component);\r\n\t\t\t\t\telse if(collection.type === \"cognate\")\r\n\t\t\t\t\t\tcognateCollections.push(component);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tjourneys =\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className={\"header-container\"}>\r\n\t\t\t\t\t\t<h4>Journeys</h4>\r\n\t\t\t\t\t\t<Button value={\"+\"} id={\"manual-add\"} style={{alignSelf: \"end\"}}\r\n\t\t\t\t\t\t        onClick={(e) => {\r\n\t\t\t\t\t\t\t        this.props.openModal(e, <AddEditCollectionModal onCollectionSubmit={this.props.addCollection}/>);\r\n\t\t\t\t\t\t        }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{journeyCollections}\r\n\t\t\t\t</>;\r\n\t\t\tcognates =\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className={\"header-container\"}>\r\n\t\t\t\t\t\t<h4>Cognates</h4>\r\n\t\t\t\t\t\t<Button value={\"+\"} id={\"manual-add\"} style={{alignSelf: \"end\"}}\r\n\t\t\t\t\t\t        onClick={(e) => {\r\n\t\t\t\t\t\t\t        if(this.props.collections)\r\n\t\t\t\t\t\t\t\t        this.props.openModal(e, <AddEditCollectionModal onCollectionSubmit={this.props.addCollection} type={\"cognate\"}/>);\r\n\t\t\t\t\t\t        }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{cognateCollections}\r\n\t\t\t\t</>;\r\n\r\n\t\t\toutput.push(journeys); output.push(cognates);\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"collections-container\"}>\r\n\t\t\t\t{header}\r\n\t\t\t\t{output}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\ControlBox.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\AddEditNodeModal.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\ContextMenu.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\LoginRegisterModal.jsx",["138"],"import {Component} from \"react\";\r\nimport {Textbox} from \"../controls/Textbox\";\r\nimport {Button} from \"../controls/Button\";\r\nimport {LabeledControl} from \"../controls/LabeledControl\";\r\nimport {GenericModal} from \"./GenericModal\";\r\n\r\nexport class LoginRegisterModal extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tmode: this.props.mode, // \"login\" || \"register\"\r\n\r\n\t\t\t/* Login */\r\n\t\t\tloginUsername: \"\",\r\n\t\t\tloginPassword: \"\",\r\n\t\t\trememberMe: false,\r\n\r\n\t\t\t/* Register */\r\n\t\t\tdisplayName: \"\",\r\n\t\t\tusername: \"\",\r\n\t\t\tpassword: \"\",\r\n\t\t\tpasswordConfirm: \"\",\r\n\t\t\temail: \"\",\r\n\t\t\temailConfirm: \"\",\r\n\t\t\tdataConsent: false\r\n\t\t};\r\n\r\n\t\tthis.onFieldChange = this.onFieldChange.bind(this);\r\n\t\tthis.validate = this.validate.bind(this);\r\n\t}\r\n\r\n\tcomponentDidMount()\r\n\t{\r\n\t\t// Load in preserved data\r\n\t\tconst loginRegisterForm = JSON.parse(localStorage.getItem(\"LEMA_loginRegisterForm\"));\r\n\t\tif(loginRegisterForm)\r\n\t\t{\r\n\t\t\tloginRegisterForm.mode = this.props.mode;\r\n\t\t\tthis.setState(loginRegisterForm);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonFieldChange(event)\r\n\t{\r\n\t\tconst target = event.target;\r\n\t\tconst name = target.name;\r\n\t\tconst value = (target.type === \"checkbox\") ? target.checked : target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\t[name]: value\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Validates form data.\r\n\t * @param mode Whether to validate login or register data\r\n\t * @returns {boolean}\r\n\t */\r\n\tvalidate(mode)\r\n\t{\r\n\t\tlet errorCollector = \"\";\r\n\t\tif(mode === \"login\")\r\n\t\t{\r\n\t\t\t// New user data\r\n\t\t\tconst username = this.state.loginUsername;\r\n\t\t\tconst password = this.state.loginPassword;\r\n\r\n\t\t\t// Client-side validation\r\n\t\t\tif(username === \"\")\r\n\t\t\t\terrorCollector += \"Username missing.\\n\";\r\n\t\t\tif(password === \"\")\r\n\t\t\t\terrorCollector += \"Password missing.\\n\";\r\n\t\t}\r\n\t\telse if(mode === \"register\")\r\n\t\t{\r\n\t\t\tconst dataConsent = this.state.dataConsent;\r\n\t\t\tif(!dataConsent)\r\n\t\t\t{\r\n\t\t\t\terrorCollector += \"You must agree to the privacy policy to create a profile.\";\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// New user data\r\n\t\t\t\tconst username = this.state.username;\r\n\t\t\t\tconst displayName = this.state.displayName;\r\n\t\t\t\tconst password = this.state.password;\r\n\t\t\t\tconst passwordConfirm = this.state.passwordConfirm;\r\n\t\t\t\tconst email = this.state.email;\r\n\t\t\t\tconst emailConfirm = this.state.emailConfirm;\r\n\r\n\t\t\t\t// Client-side validation\r\n\t\t\t\tif(displayName.length < 3)\r\n\t\t\t\t\terrorCollector += \"Display name too short (min. 3 characters).\\n\";\r\n\t\t\t\tif(displayName.length > 32)\r\n\t\t\t\t\terrorCollector += \"Display name too long (max. 32 characters).\\n\";\r\n\t\t\t\tif(username.length < 3)\r\n\t\t\t\t\terrorCollector += \"Username too short (min. 3 characters).\\n\";\r\n\t\t\t\tif(username.length > 32)\r\n\t\t\t\t\terrorCollector += \"Username too long (max. 32 characters).\\n\";\r\n\t\t\t\tif(password.length < 6)\r\n\t\t\t\t\terrorCollector += \"Password too short (min. 6 characters).\\n\";\r\n\t\t\t\tif(password !== passwordConfirm)\r\n\t\t\t\t\terrorCollector += \"Passwords do not match.\\n\";\r\n\t\t\t\tif(!email.match(/^[a-zA-Z0-9.!#$%&*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/))\r\n\t\t\t\t\terrorCollector += \"E-mail address invalid.\\n\";\r\n\t\t\t\tif(email !== emailConfirm)\r\n\t\t\t\t\terrorCollector += \"E-mail addresses do not match.\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(errorCollector !== \"\")\r\n\t\t{\r\n\t\t\tthis.props.createToast(null, errorCollector, 5000, \"error\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse return true;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\treturn (\r\n\t\t\t<div className={\"modal\"}>\r\n\t\t\t\t<div className={\"top\"}>\r\n\t\t\t\t\t{this.state.mode === \"login\" &&\r\n\t\t\t\t\t\t<div className={\"left login\"}>\r\n\t\t\t\t\t\t\t<h2>Login</h2>\r\n\t\t\t\t\t\t\t<div className={\"login-register-data\"}>\r\n\t\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Username: \"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"loginUsername\"} value={this.state.loginUsername} hint={\"\"} autoFocus={true} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Password: \"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"loginPassword\"} isPassword={true} value={this.state.loginPassword} hint={\"\"} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Remember me:\"} tooltip={\"This will set an essential cookie to keep you logged in.\"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type={\"checkbox\"} name={\"rememberMe\"} checked={this.state.rememberMe} onChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{this.state.mode === \"register\" &&\r\n\t\t\t\t\t\t<div className={\"left register\"}>\r\n\t\t\t\t\t\t\t<h2>Register</h2>\r\n\t\t\t\t\t\t\t<div className={\"login-register-data\"}>\r\n\t\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t\t<h4>User Data</h4>\r\n\t\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Username: \"} tooltip={\"Min. 3 characters.\\nMax. 32 characters.\"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"username\"} value={this.state.username} hint={\"e.g. \\\"JordanFinch72\\\"\"} autoFocus={true} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Password: \"} tooltip={\"Min. 6 characters.\"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"password\"} isPassword={true} value={this.state.password} hint={\"\"} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Password (confirm): \"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"passwordConfirm\"} isPassword={true} value={this.state.passwordConfirm} hint={\"\"} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"E-mail address: \"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"email\"} value={this.state.email} hint={\"e.g. \\\"lema@jordanfinch.dev\\\"\"} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"E-mail address (confirm): \"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"emailConfirm\"} value={this.state.emailConfirm} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Display name: \"} tooltip={\"Display name shown on Community Showcase.\\nMin. 3 characters.\\nMax. 3 characters.\"}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Textbox name={\"displayName\"} value={this.state.displayName} hint={\"e.g. \\\"Master of Maps\\\"\"} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t\t<h4>Legal Stuff</h4>\r\n\t\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t\t<p>By ticking this box, you agree that your user data will be used in accordance with the <a href={\"#\"} onClick={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst privacyPolicy =\r\n\t\t\t\t\t\t\t\t\t\t\t\t<GenericModal>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<main>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h1>Data & Privacy Policy</h1>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>This privacy policy details how the software Linguistic Etymology Map Assistant (LEMA) will handle private and/or personal user data submitted to it.</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>User Data</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>Any personally-identifiable data (PID) submitted to LEMA will be secured and encrypted using HTTPS/SSL protocols during its passage from client to server.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>Passwords submitted to LEMA will be appropriately secured by the server before being stored in any database.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>No user data will <b>ever</b> be shared with any third party and will be used <b>solely</b> for the functions of LEMA itself.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>Cookies</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>LEMA uses <i>localStorage</i> cookies to: (1) keep you logged in; (2) auto-save your active maps and their collections so that you do not lose work by closing the app.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>localStorage use (1) is opt-in and this cookie can be avoided by not ticking the \"Remember me\" box when you log in. If you have already done so, logging out will delete the cookie.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>localStorage use (1) is an essential cookie for the proper function of this app. There is currently no way to opt out. If you feel that this option would be important, please contact me.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>Community Showcase</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>Any maps shared on the Community Showcase will have all of their data - in addition to the username and display name of the map owner - exposed to all other users of LEMA.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li>If you wish your map to no longer be shared on the Community Showcase, you may load the map and then re-save it with the \"Share to showcase\" box unticked.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</main>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</GenericModal>\r\n\t\t\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\"LEMA_loginRegisterForm\", JSON.stringify(this.state)); // Preserve data\r\n\t\t\t\t\t\t\t\t\t\t\tthis.props.openModal(e, privacyPolicy, true);\r\n\t\t\t\t\t\t\t\t\t\t}}>privacy policy</a>.</p>\r\n\t\t\t\t\t\t\t\t\t\t<input type={\"checkbox\"} name={\"dataConsent\"} checked={this.state.dataConsent} onChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={\"bottom\"}>\r\n\t\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t\t<Button value={\"Submit\"} onClick={(e) =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(this.validate(this.state.mode))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlocalStorage.removeItem(\"LEMA_loginRegisterForm\");\r\n\t\t\t\t\t\t\t\tthis.props.handler(e, this.state);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Textbox.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\AddEditCollectionModal.jsx",["139"],"import {Component} from \"react\";\r\nimport {Textbox} from \"../controls/Textbox\";\r\nimport {Button} from \"../controls/Button\";\r\nimport {LabeledControl} from \"../controls/LabeledControl\";\r\nimport {ColourPicker} from \"../controls/ColourPicker\";\r\n\r\nexport class AddEditCollectionModal extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\ttype: (this.props.type === \"cognate\") ? \"Cognates\" : \"Historical journey\",\r\n\t\t\tname: this.props.name || null\r\n\t\t};\r\n\r\n\t\tthis.onCollectionSubmit = this.props.onCollectionSubmit.bind(this);\r\n\t\tthis.onFieldChange = this.onFieldChange.bind(this);\r\n\t\tthis.validation = this.validation.bind(this);\r\n\t}\r\n\r\n\tonFieldChange(event)\r\n\t{\r\n\t\tconst target = event.target;\r\n\t\tconst name = target.name;\r\n\t\tconst value = target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\t[name]: value\r\n\t\t});\r\n\t}\r\n\r\n\tvalidation()\r\n\t{\r\n\t\t// Data validation\r\n\t\t// TODO: For cognates, only one cognate per language should be allowed\r\n\t\t//  - Future feature: for additional cognate collections, change solid colours to patterns of the specified colours instead (e.g. stripes; checks)\r\n\t\tlet errorCollector = \"\";\r\n\t\tif(this.state.name === null || this.state.name.length <= 0)\r\n\t\t\terrorCollector += \"You must enter a name.\\n\";\r\n\r\n\t\tif(errorCollector.length > 0)\r\n\t\t{\r\n\t\t\tthis.props.createToast(null, errorCollector, 5000, \"error\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse return true;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\treturn (\r\n\t\t\t<div className={\"modal\"}>\r\n\t\t\t\t<div className={\"top\"}>\r\n\t\t\t\t\t<div className={\"left\"}>\r\n\t\t\t\t\t\t<h2>New Collection</h2>\r\n\t\t\t\t\t\t<div className={\"node-data\"}>\r\n\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Name: \"}>\r\n\t\t\t\t\t\t\t\t\t\t<Textbox name={\"name\"} value={this.state.name} hint={\"e.g. \\\"horse (PIE->English)\\\"\"} autoFocus={true} onFieldChange={this.onFieldChange} />\r\n\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t\t<LabeledControl label={\"Type: \"}>\r\n\t\t\t\t\t\t\t\t\t\t<select name={\"type\"} value={this.state.type} onChange={this.onFieldChange}>\r\n\t\t\t\t\t\t\t\t\t\t\t<option>Historical journey</option>\r\n\t\t\t\t\t\t\t\t\t\t\t<option>Cognates</option>\r\n\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t</LabeledControl>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={\"bottom\"}>\r\n\t\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t\t<Button value={\"Submit\"} id={\"add-collection-modal-submit\"} onClick={(e) =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(this.validation())\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tconst type = (this.state.type === \"Historical journey\") ? \"journey\" : \"cognate\";\r\n\t\t\t\t\t\t\t\tconst data = {type: type, header: {name: this.state.name}, index: this.props.index};\r\n\t\t\t\t\t\t\t\tthis.props.onCollectionSubmit(e, data);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\RadioGroup.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Collection.jsx",["140","141"],"import React, {Component} from \"react\";\r\nimport {Collapser} from \"./controls/Collapser\";\r\nimport {AddEditCollectionModal} from \"./modals/AddEditCollectionModal\";\r\nimport {AddEditNodeModal} from \"./modals/AddEditNodeModal\";\r\nimport {Button} from \"./controls/Button\";\r\n\r\nclass CollectionNode extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst nodeColour = this.props.node.fillColour || this.props.node.vertex.fillColour; // TODO: Advanced logic for determining next unused colour (per journey)\r\n\t\tlet changeColourTimeout;\r\n\t\tconst collectionList = this.props.collections.filter((collection, i) => {\r\n\t\t\tif(collection.type === this.props.type)\r\n\t\t\t{\r\n\t\t\t\tcollection.collectionIndex = i;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"collection-node\"}>\r\n\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.props.openModal(e, <AddEditNodeModal\r\n\t\t\t\t\t\tcollectionList={collectionList}\r\n\t\t\t\t\t\twords={this.props.words}\r\n\t\t\t\t\t\ttype={this.props.type}\r\n\t\t\t\t\t\tnode={this.props.node}\r\n\t\t\t\t\t\tlanguage={this.props.node.language}\r\n\t\t\t\t\t\tonNodeSubmit={this.props.editNode}\r\n\t\t\t\t\t\tcollectionIndex={this.props.collectionIndex}\r\n\t\t\t\t\t\tcreateToast={this.props.createToast}\r\n\t\t\t\t\t/>);\r\n\t\t\t\t}}>{this.props.node.word}</div>\r\n\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.props.openModal(e, <AddEditNodeModal\r\n\t\t\t\t\t\tcollectionList={collectionList}\r\n\t\t\t\t\t\twords={this.props.words}\r\n\t\t\t\t\t\ttype={this.props.type}\r\n\t\t\t\t\t\tnode={this.props.node}\r\n\t\t\t\t\t\tlanguage={this.props.node.language}\r\n\t\t\t\t\t\tonNodeSubmit={this.props.editNode}\r\n\t\t\t\t\t\tcollectionIndex={this.props.collectionIndex}\r\n\t\t\t\t\t\tcreateToast={this.props.createToast}\r\n\t\t\t\t\t/>);\r\n\t\t\t\t}}>{this.props.node.language}</div>\r\n\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t<input type={\"color\"} defaultValue={nodeColour} onChange={(e) => {\r\n\t\t\t\t\t\t// Throttle the onChange; there's no way to have it only change when the user clicks off of it, annoyingly\r\n\t\t\t\t\t\tconst node = this;\r\n\t\t\t\t\t\twindow.clearTimeout(changeColourTimeout);\r\n\t\t\t\t\t\tchangeColourTimeout = window.setTimeout(function()\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst updatedNode = {\r\n\t\t\t\t\t\t\t\t...node.props.node\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif(node.props.type === \"journey\")\r\n\t\t\t\t\t\t\t\tupdatedNode.vertex.fillColour = e.target.value;\r\n\t\t\t\t\t\t\telse if(node.props.type === \"cognate\")\r\n\t\t\t\t\t\t\t\tupdatedNode.fillColour = e.target.value;\r\n\t\t\t\t\t\t\tnode.props.editNode(e, node.props.collectionIndex, updatedNode);\r\n\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t<Button value={\"X\"} id={\"remove-node\"}\r\n\t\t\t\t\t        onClick={(e) => this.props.removeNode(e, this.props.collectionIndex, this.props.node.arrayIndex)}/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport class Collection extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tcollapsed: false, // Note: Could be lifted if we want persistence when editing types\r\n\t\t};\r\n\r\n\t\tthis.toggleCollapse = this.toggleCollapse.bind(this);\r\n\t}\r\n\r\n\ttoggleCollapse(e)\r\n\t{\r\n\t\tthis.setState({collapsed: !this.state.collapsed});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst wordComponents = [];\r\n\t\tconsole.log(this.props);\r\n\r\n\t\tif(!this.state.collapsed)\r\n\t\t{\r\n\t\t\tfor(let i = 0; i < this.props.words.length; ++i)\r\n\t\t\t{\r\n\t\t\t\twordComponents.push(<CollectionNode\r\n\t\t\t\t\tkey={i}\r\n\t\t\t\t\tcollections={this.props.collections}\r\n\t\t\t\t\ttype={this.props.type}\r\n\t\t\t\t\twords={this.props.words}\r\n\t\t\t\t\tnode={this.props.words[i]}\r\n\t\t\t\t\teditNode={this.props.editNode}\r\n\t\t\t\t\tremoveNode={this.props.removeNode}\r\n\t\t\t\t\topenModal={this.props.openModal}\r\n\t\t\t\t\tcollectionIndex={this.props.index}  // Index of collection the node belongs to\r\n\t\t\t\t\tcreateToast={this.props.createToast}\r\n\t\t\t\t/>);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"collection-container\"}>\r\n\t\t\t\t<div className={\"collection-header\"}>\r\n\t\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t\t<div className={\"name\"} onClick={(e) =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.props.openModal(e, <AddEditCollectionModal\r\n\t\t\t\t\t\t\ttype={this.props.type}\r\n\t\t\t\t\t\t\tname={this.props.header.name}\r\n\t\t\t\t\t\t\tonCollectionSubmit={this.props.editCollection}\r\n\t\t\t\t\t\t\tindex={this.props.index}\r\n\t\t\t\t\t\t\tcreateToast={this.props.createToast}\r\n\t\t\t\t\t\t/>);\r\n\t\t\t\t\t}}>{this.props.header.name}</div>\r\n\t\t\t\t\t<div className={\"meatball-collapser-container\"}>\r\n\t\t\t\t\t\t<Button value={\"+\"} id={\"manual-add\"} style={{alignSelf: \"end\"}}\r\n\t\t\t\t\t\t        onClick={(e) => {\r\n\t\t\t\t\t\t\t        this.props.cAddNode(e, {type: this.props.type, collectionIndex: this.props.index, words: this.props.words});\r\n\t\t\t\t\t\t        }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<Button value={\"X\"} id={\"manual-delete\"} style={{alignSelf: \"end\"}}\r\n\t\t\t\t\t\t        onClick={(e) => {\r\n\t\t\t\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will remove the entire collection of nodes from your map.\\nDo you wish to continue?\");\r\n\t\t\t\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\t            this.props.cRemoveCollection(e, this.props.index);\r\n\t\t\t\t\t\t        }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<Collapser toggleCollapse={this.toggleCollapse} collapsed={this.state.collapsed}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{wordComponents}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Button.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\LabeledControl.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\ColourPicker.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Meatballs.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\controls\\Collapser.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\SaveModal.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\ViewMapsModal.jsx",["142","143","144","145"],"import {Component} from \"react\";\r\nimport {Textbox} from \"../controls/Textbox\";\r\nimport {Button} from \"../controls/Button\";\r\nimport {LabeledControl} from \"../controls/LabeledControl\";\r\nimport axios from \"axios\";\r\nimport {GenericModal} from \"./GenericModal\";\r\n\r\nclass MapItem extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className={\"map-item\"}>\r\n\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t<div className={\"title\"}>{this.props.map.activeMap.title}</div>\r\n\t\t\t\t<div className={\"buttons-container\"}>\r\n\t\t\t\t\t<Button value={\"LOAD\"} onClick={(e) => {\r\n\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will overwrite your currently active map.\\nYou may wish to save your map before you load another one.\\n\\nWould you like to continue?\");\r\n\r\n\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\tthis.props.loadMap(e, this.props.map, \"database\");\r\n\t\t\t\t\t}} />\r\n\t\t\t\t\t<Button value={\"X\"} onClick={(e) => {\r\n\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will permanently delete this map from the database (and the showcase)!\\n\\nWould you like to continue?\");\r\n\r\n\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\tthis.props.deleteMap(e, this.props.map.activeMap.mapID);\r\n\t\t\t\t\t}} />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport class ViewMapsModal extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tloadedMaps: [],\r\n\t\t\tloadedFileName: null,\r\n\t\t\tloading: true\r\n\t\t};\r\n\r\n\t\tthis.onFieldChange = this.onFieldChange.bind(this);\r\n\r\n\t}\r\n\r\n\tcomponentDidMount()\r\n\t{\r\n\t\tthis.loadUserMaps(this.props.activeUser.username, this.props.activeUser.jwt);\r\n\t}\r\n\r\n\tloadUserMaps(username, jwt)\r\n\t{\r\n\t\tconsole.debug(\"[== LOADING MAPS ==]\");\r\n\r\n\t\t// Fetch maps belonging to this user\r\n\t\taxios.get(`/maps/${username}/0/${jwt}`).then((response) =>\r\n\t\t{\r\n\t\t\tconst handleResponse = this.props.handleResponse(response, \"User's maps retrieved.\", null, false);\r\n\t\t\tconsole.log(handleResponse);\r\n\t\t\tif(handleResponse === true)\r\n\t\t\t{\r\n\t\t\t\tthis.setState({loadedMaps: response.data.maps, loading: false})\r\n\t\t\t}\r\n\t\t\telse if(handleResponse === false)\r\n\t\t\t{\r\n\t\t\t\tconsole.error(\"Error loading maps.\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.loadUserMaps(this.props.activeUser.username, this.props.activeUser.jwt);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonFieldChange(event)\r\n\t{\r\n\t\tconst target = event.target;\r\n\t\tconst name = target.name;\r\n\t\tconst value = (target.type === \"checkbox\") ? target.checked : target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\t[name]: value\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tlet mapItems = [];\r\n\t\tthis.state.loadedMaps.forEach((m) => mapItems.push(<MapItem activeUser={this.props.activeUser} map={m} openModal={this.props.openModal}\r\n\t\t                                                            loadMap={this.props.loadMap} deleteMap={this.props.deleteMap} />));\r\n\t\tif(this.state.loading)\r\n\t\t\tmapItems = \"Loading...\";\r\n\t\telse if(mapItems.length === 0)\r\n\t\t\tmapItems = \"No maps here! Try saving one to your profile! Alternatively, feel free to load one in from a file.\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"modal\"}>\r\n\t\t\t\t<div className={\"top\"}>\r\n\t\t\t\t\t<div className={\"left load\"}>\r\n\t\t\t\t\t\t<h2>View / Import Map</h2>\r\n\t\t\t\t\t\t<div className={\"map-data\"}>\r\n\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t{mapItems}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className={\"section\"}>\r\n\t\t\t\t\t\t\t\t<h4>Load From File</h4>\r\n\t\t\t\t\t\t\t\t<div className={\"form\"}>\r\n\t\t\t\t\t\t\t\t\t<input type={\"file\"} id={\"mapJSON\"} name={\"mapJSON\"} accept={\"application/json\"} />\r\n\t\t\t\t\t\t\t\t\t<Button value={\"Import...\"} onClick={(e) =>\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tconst files = document.getElementById(\"mapJSON\").files;\r\n\t\t\t\t\t\t\t\t\t\tif(files.length > 0)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tconst userConfirmed = window.confirm(\"This will overwrite your current map.\\nYou should save your map before you load another one.\\n\\nWould you like to continue?\");\r\n\t\t\t\t\t\t\t\t\t\t\tif(userConfirmed)\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileReader = new window.FileReader();\r\n\t\t\t\t\t\t\t\t\t\t\t\tfileReader.onload = () => this.props.loadMap(e, JSON.parse(fileReader.result), \"file\");\r\n\t\t\t\t\t\t\t\t\t\t\t\tfileReader.readAsText(files[0]);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={\"bottom\"}>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\ProfileSettingsModal.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\CommunityMap.jsx",["146","147","148","149","150","151"],"import React, {Component} from \"react\";\r\nimport {Meatballs} from \"./controls/Meatballs\";\r\nimport {Collapser} from \"./controls/Collapser\";\r\nimport {AddEditCollectionModal} from \"./modals/AddEditCollectionModal\";\r\nimport {AddEditNodeModal} from \"./modals/AddEditNodeModal\";\r\nimport {Button} from \"./controls/Button\";\r\n\r\nexport class CommunityMap extends Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\treturn (\r\n\t\t\t<div className={\"community-map\"} onClick={(e) => {\r\n\t\t\t\t// TODO: Load the map (equivalent to opening its link)\r\n\t\t\t\tconst mapID = this.props.mapID, username = this.props.owner;\r\n\t\t\t\tconst userConfirmed = window.confirm(\"Load this map? This will overwrite your active map.\\nYou may wish to save your own map first.\\n\\n\" +\r\n\t\t\t\t\t\"Do you with to continue?\");\r\n\r\n\t\t\t\tif(userConfirmed) window.location.href = `/map/${username}/${mapID}`;\r\n\t\t\t}}>\r\n\t\t\t\t{/* Flex-row */}\r\n\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t{\r\n\t\t\t\t\t// TODO: Consider revealing the full title (if clipped)\r\n\t\t\t\t}}>{this.props.title}</div>\r\n\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t{\r\n\t\t\t\t\t// TODO: Consider revealing the full description (if clipped)\r\n\t\t\t\t}}>{this.props.description}</div>\r\n\t\t\t\t<div onClick={(e) =>\r\n\t\t\t\t{\r\n\t\t\t\t\t// TODO: Search for all maps by this owner\r\n\t\t\t\t}}>{this.props.owner}</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\modals\\GenericModal.jsx",[],"D:\\xampp\\htdocs\\COMP3000_LEMA\\Project\\lema\\client\\src\\components\\Toast.jsx",[],{"ruleId":"152","severity":1,"message":"153","line":5,"column":8,"nodeType":"154","messageId":"155","endLine":5,"endColumn":23},{"ruleId":"156","replacedBy":"157"},{"ruleId":"158","replacedBy":"159"},{"ruleId":"152","severity":1,"message":"160","line":4,"column":9,"nodeType":"154","messageId":"155","endLine":4,"endColumn":15},{"ruleId":"161","severity":1,"message":"162","line":87,"column":67,"nodeType":"163","messageId":"164","endLine":87,"endColumn":69},{"ruleId":"161","severity":1,"message":"162","line":113,"column":67,"nodeType":"163","messageId":"164","endLine":113,"endColumn":69},{"ruleId":"161","severity":1,"message":"162","line":141,"column":66,"nodeType":"163","messageId":"164","endLine":141,"endColumn":68},{"ruleId":"165","severity":1,"message":"166","line":268,"column":29,"nodeType":"167","messageId":"168","endLine":268,"endColumn":31},{"ruleId":"165","severity":1,"message":"166","line":268,"column":49,"nodeType":"167","messageId":"168","endLine":268,"endColumn":51},{"ruleId":"165","severity":1,"message":"169","line":268,"column":49,"nodeType":"167","messageId":"168","endLine":268,"endColumn":51},{"ruleId":"165","severity":1,"message":"169","line":268,"column":69,"nodeType":"167","messageId":"168","endLine":268,"endColumn":71},{"ruleId":"161","severity":1,"message":"162","line":433,"column":67,"nodeType":"163","messageId":"164","endLine":433,"endColumn":69},{"ruleId":"170","severity":1,"message":"171","line":488,"column":18,"nodeType":"163","messageId":"172","endLine":536,"endColumn":7},{"ruleId":"165","severity":1,"message":"166","line":492,"column":28,"nodeType":"167","messageId":"168","endLine":492,"endColumn":30},{"ruleId":"165","severity":1,"message":"166","line":492,"column":48,"nodeType":"167","messageId":"168","endLine":492,"endColumn":50},{"ruleId":"165","severity":1,"message":"169","line":492,"column":48,"nodeType":"167","messageId":"168","endLine":492,"endColumn":50},{"ruleId":"165","severity":1,"message":"169","line":492,"column":68,"nodeType":"167","messageId":"168","endLine":492,"endColumn":70},{"ruleId":"152","severity":1,"message":"173","line":570,"column":9,"nodeType":"154","messageId":"155","endLine":570,"endColumn":19},{"ruleId":"174","severity":1,"message":"175","line":10,"column":2,"nodeType":"176","messageId":"177","endLine":13,"endColumn":3},{"ruleId":"161","severity":1,"message":"178","line":115,"column":45,"nodeType":"163","messageId":"179","endLine":115,"endColumn":47},{"ruleId":"161","severity":1,"message":"178","line":143,"column":51,"nodeType":"163","messageId":"179","endLine":143,"endColumn":53},{"ruleId":"180","severity":1,"message":"181","line":176,"column":101,"nodeType":"182","endLine":209,"endColumn":14},{"ruleId":"152","severity":1,"message":"183","line":5,"column":9,"nodeType":"154","messageId":"155","endLine":5,"endColumn":21},{"ruleId":"174","severity":1,"message":"175","line":9,"column":2,"nodeType":"176","messageId":"177","endLine":12,"endColumn":3},{"ruleId":"161","severity":1,"message":"162","line":18,"column":72,"nodeType":"163","messageId":"164","endLine":18,"endColumn":74},{"ruleId":"152","severity":1,"message":"184","line":2,"column":9,"nodeType":"154","messageId":"155","endLine":2,"endColumn":16},{"ruleId":"152","severity":1,"message":"185","line":4,"column":9,"nodeType":"154","messageId":"155","endLine":4,"endColumn":23},{"ruleId":"152","severity":1,"message":"186","line":6,"column":9,"nodeType":"154","messageId":"155","endLine":6,"endColumn":21},{"ruleId":"174","severity":1,"message":"175","line":10,"column":2,"nodeType":"176","messageId":"177","endLine":13,"endColumn":3},{"ruleId":"152","severity":1,"message":"187","line":2,"column":9,"nodeType":"154","messageId":"155","endLine":2,"endColumn":18},{"ruleId":"152","severity":1,"message":"188","line":3,"column":9,"nodeType":"154","messageId":"155","endLine":3,"endColumn":18},{"ruleId":"152","severity":1,"message":"189","line":4,"column":9,"nodeType":"154","messageId":"155","endLine":4,"endColumn":31},{"ruleId":"152","severity":1,"message":"190","line":5,"column":9,"nodeType":"154","messageId":"155","endLine":5,"endColumn":25},{"ruleId":"152","severity":1,"message":"191","line":6,"column":9,"nodeType":"154","messageId":"155","endLine":6,"endColumn":15},{"ruleId":"174","severity":1,"message":"175","line":10,"column":2,"nodeType":"176","messageId":"177","endLine":13,"endColumn":3},"no-unused-vars","'reportWebVitals' is defined but never used.","Identifier","unusedVar","no-native-reassign",["192"],"no-negated-in-lhs",["193"],"'useJwt' is defined but never used.","array-callback-return","Array.prototype.filter() expects a value to be returned at the end of arrow function.","ArrowFunctionExpression","expectedAtEnd","no-mixed-operators","Unexpected mix of '&&' and '||'. Use parentheses to clarify the intended order of operations.","LogicalExpression","unexpectedMixedOperator","Unexpected mix of '||' and '&&'. Use parentheses to clarify the intended order of operations.","no-loop-func","Function declared in a loop contains unsafe references to variable(s) 'startEdgeXOffset', 'startEdgeYOffset', 'startEdgeXOffset', 'startEdgeYOffset'.","unsafeRefs","'graticules' is assigned a value but never used.","no-useless-constructor","Useless constructor.","MethodDefinition","noUselessConstructor","Array.prototype.map() expects a return value from arrow function.","expectedInside","jsx-a11y/anchor-is-valid","The href attribute requires a valid value to be accessible. Provide a valid, navigable address as the href value. If you cannot provide a valid href, but still need the element to resemble a link, use a button and change it with appropriate styles. Learn more: https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/HEAD/docs/rules/anchor-is-valid.md","JSXOpeningElement","'ColourPicker' is defined but never used.","'Textbox' is defined but never used.","'LabeledControl' is defined but never used.","'GenericModal' is defined but never used.","'Meatballs' is defined but never used.","'Collapser' is defined but never used.","'AddEditCollectionModal' is defined but never used.","'AddEditNodeModal' is defined but never used.","'Button' is defined but never used.","no-global-assign","no-unsafe-negation"]